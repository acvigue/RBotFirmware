<html>
<head>

<style>
body {
  margin: 0;
  padding: 0;
  font-family: monospace;
  align-items: center;
  justify-content: center;
}

p {
    margin-top: 20px;
    text-align: center;
}

canvas {
  display: block;
  float: left;
  margin: 20px auto;
  background-color: white;
}

#tooltip {
  position: absolute;
  text-align: center;
  width: 100px;
  height: 12px;
  padding: 8px;
  margin-top: -20px;
  font: 10px sans-serif;
  background: #ddd;
  pointer-events: none;
}
#table-canvas {
    width: auto;
    height: auto;
    object-fit: contain;
}
#sand {
  display: block;
  float: left;
  margin: 20px auto;
  background-color: white;
  width: 600px;
  height: 600px;
}
.colourTableDiv {
    margin: 20px auto;
    padding: 10px;
    float:left;
}
.colourTableWhole {
    background: antiquewhite;
    padding: 10px;
}
.colourTable {
    
}
.colourStr {
    margin: 5px;
    width: 300px;
}
.selected {
    border: solid 2px red;
}
    .colourPatch {

    }
    .colourPatchDiv {
        width:10px;
        height:10px;
        background-color: #000000;
    }
</style>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.bundle.js"></script>
</head>
<body>
<p>Sand Table Sim</p>
<canvas id="table-canvas" onmousedown="mouseclicktable(event);"></canvas>
<canvas id="chart-canvas" width="400" height="400"></canvas>
<image id="sand" src="./images/20190202_172025.jpg" onmousedown="mouseclickimg(event);"></image>
<div class="colourTableDiv">
    <div class="colourTableWhole">
        <p>Colour table</p>
        <table class="colourTable" id="colourTable">
            <tr><th>Idx</th><th>ColourStr</th></tr>
            <tr><td class="cidx">0</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">1</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">2</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">3</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">4</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">5</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">6</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">7</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">8</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
            <tr><td class="cidx">9</td><td><input class="colourStr" type="text"></td><td class="colourPatch"><div class="colourPatchDiv"></div></td></tr>
        </table>
    </div>
</div>
<div id="tooltip" style="display:inline"></div>
<script>

function rgb(r,g,b,a) {
    return [r,g,b,a];
}

class SandTableSim {
    constructor(ballDiameter, sandTableSideLen, canvasBorder, options) {
        this.options = {
            canvasBorder: canvasBorder,
            sandTableSideLen: Math.ceil(sandTableSideLen),
            kernelSize: 2 * ballDiameter,
            ballPos: [sandTableSideLen/2, sandTableSideLen/2],
            ballDiameter: ballDiameter,
            sandStartLevel: ballDiameter/2,
            maxSandLevel: ballDiameter,
            imgPixSqSize: 5,
            numShadingRings: ballDiameter
        };

        this.evalExpr = {
            t: 0,
            x: sandTableSideLen/2,
            y: sandTableSideLen/2,
            r: 0
        };

        this.totalSandLoss = 0;

        this.baseSandColours =
            // [rgb(228,219,188,255),rgb(219,210,177,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(213,204,171,255),rgb(215,206,173,255),rgb(221,212,179,255),rgb(218,209,176,255),rgb(220,209,177,255),rgb(212,201,169,255),rgb(219,210,177,255),rgb(218,209,176,255),rgb(216,207,174,255),rgb(216,205,173,255),rgb(213,202,170,255),rgb(219,210,177,255),rgb(222,213,180,255),rgb(218,209,176,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(213,204,171,255),rgb(214,205,172,255),rgb(214,205,172,255),rgb(207,196,164,255),rgb(203,192,160,255)],
            [rgb(229,218,186,255),rgb(232,221,189,255),rgb(221,212,179,255),rgb(227,218,185,255),rgb(220,211,178,255),rgb(222,211,179,255),rgb(228,217,185,255),rgb(221,212,179,255),rgb(220,211,178,255),rgb(229,220,187,255),rgb(225,214,182,255),rgb(223,212,180,255),rgb(228,219,186,255),rgb(225,216,183,255),rgb(217,208,175,255),rgb(226,215,183,255),rgb(226,215,183,255),rgb(225,216,183,255),rgb(223,214,181,255),rgb(214,205,172,255),rgb(215,204,172,255),rgb(231,220,188,255),rgb(222,213,180,255),rgb(216,207,174,255),rgb(219,210,177,255)]
        //    [rgb(164,142,85,255),rgb(184,162,105,255),rgb(169,147,89,255),rgb(141,119,61,255),rgb(154,132,74,255),rgb(136,114,57,255),rgb(100,78,21,255),rgb(142,120,63,255),rgb(149,127,69,255),rgb(151,129,71,255),rgb(139,116,62,255),rgb(120,98,42,255),rgb(108,86,29,255),rgb(141,119,62,255),rgb(141,119,62,255),rgb(139,116,62,255),rgb(141,118,63,255),rgb(145,122,66,255),rgb(140,118,61,255),rgb(124,102,45,255),rgb(122,99,46,255),rgb(123,100,46,255),rgb(129,107,52,255),rgb(137,115,58,255),rgb(125,103,46,255)];

        //
        // this.sandColours = [
            // [rgb(166,120,84,255),rgb(164,118,82,255),rgb(156,110,74,255),rgb(151,107,68,255),rgb(170,126,87,255),rgb(161,115,79,255),rgb(165,119,83,255),rgb(179,133,97,255),rgb(156,111,73,255),rgb(171,127,88,255),rgb(149,103,67,255),rgb(158,112,76,255),rgb(158,112,76,255),rgb(169,123,86,255),rgb(170,125,86,255),rgb(162,116,80,255),rgb(154,108,72,255),rgb(154,108,72,255),rgb(165,119,83,255),rgb(162,117,78,255),rgb(151,106,67,255),rgb(148,103,64,255),rgb(160,115,76,255),rgb(162,116,79,255),rgb(158,112,76,255)],
            // [rgb(162,114,74,255),rgb(159,114,73,255),rgb(163,118,77,255),rgb(168,125,83,255),rgb(178,136,94,255),rgb(152,105,65,255),rgb(156,111,70,255),rgb(161,117,76,255),rgb(161,118,76,255),rgb(192,151,108,255),rgb(176,131,90,255),rgb(165,120,79,255),rgb(176,133,91,255),rgb(163,121,79,255),rgb(168,128,85,255),rgb(171,126,87,255),rgb(163,119,80,255),rgb(163,119,80,255),rgb(154,113,72,255),rgb(166,128,86,255),rgb(169,124,85,255),rgb(159,114,75,255),rgb(151,107,68,255),rgb(168,129,88,255),rgb(190,153,111,255)],
            // [rgb(170,128,86,255),rgb(163,121,79,255),rgb(156,114,72,255),rgb(151,109,67,255),rgb(146,104,62,255),rgb(160,117,75,255),rgb(159,116,74,255),rgb(151,108,66,255),rgb(149,106,64,255),rgb(149,106,65,255),rgb(149,104,65,255),rgb(153,108,69,255),rgb(146,102,63,255),rgb(148,104,66,255),rgb(154,112,73,255),rgb(148,103,64,255),rgb(152,106,70,255),rgb(144,100,63,255),rgb(141,98,60,255),rgb(139,97,59,255),rgb(144,99,60,255),rgb(157,113,76,255),rgb(152,108,71,255),rgb(131,89,51,255),rgb(153,111,73,255)],
            // [rgb(180,146,109,255),rgb(188,153,113,255),rgb(187,152,110,255),rgb(195,160,118,255),rgb(201,167,122,255),rgb(185,151,113,255),rgb(191,156,116,255),rgb(192,157,115,255),rgb(194,159,117,255),rgb(194,160,116,255),rgb(192,158,120,255),rgb(198,163,123,255),rgb(200,165,123,255),rgb(205,171,129,255),rgb(200,167,123,255),rgb(195,161,123,255),rgb(197,162,120,255),rgb(199,164,122,255),rgb(212,179,136,255),rgb(206,173,128,255),rgb(190,157,116,255),rgb(197,164,121,255),rgb(201,168,125,255),rgb(206,173,130,255),rgb(206,174,129,255)],
            // [rgb(201,164,122,255),rgb(195,157,116,255),rgb(180,141,100,255),rgb(178,138,97,255),rgb(165,123,83,255),rgb(194,157,115,255),rgb(186,148,106,255),rgb(178,139,98,255),rgb(165,126,85,255),rgb(155,116,75,255),rgb(188,151,109,255),rgb(181,143,102,255),rgb(166,128,86,255),rgb(169,130,89,255),rgb(158,119,78,255),rgb(196,160,117,255),rgb(184,147,104,255),rgb(156,119,76,255),rgb(145,106,64,255),rgb(139,100,58,255),rgb(188,154,109,255),rgb(170,134,89,255),rgb(154,117,73,255),rgb(146,109,65,255),rgb(133,95,52,255)],
            // [rgb(209,176,131,255),rgb(209,176,131,255),rgb(208,175,130,255),rgb(210,177,132,255),rgb(207,173,128,255),rgb(214,181,136,255),rgb(210,176,131,255),rgb(207,173,128,255),rgb(204,170,125,255),rgb(203,166,122,255),rgb(208,174,129,255),rgb(208,174,129,255),rgb(207,171,127,255),rgb(202,166,121,255),rgb(197,160,116,255),rgb(209,175,130,255),rgb(204,170,125,255),rgb(203,166,122,255),rgb(207,170,126,255),rgb(192,155,111,255),rgb(201,166,121,255),rgb(204,167,123,255),rgb(201,164,120,255),rgb(201,162,119,255),rgb(201,162,119,255)],
            // [rgb(213,180,135,255),rgb(208,176,129,255),rgb(207,175,128,255),rgb(203,170,125,255),rgb(211,178,133,255),rgb(207,176,130,255),rgb(209,178,131,255),rgb(209,178,131,255),rgb(205,172,127,255),rgb(208,175,130,255),rgb(207,176,130,255),rgb(208,177,130,255),rgb(211,180,133,255),rgb(215,182,137,255),rgb(213,180,135,255),rgb(209,178,132,255),rgb(210,179,132,255),rgb(210,179,132,255),rgb(213,180,135,255),rgb(210,177,132,255),rgb(211,180,134,255),rgb(213,182,135,255),rgb(210,179,132,255),rgb(215,182,137,255),rgb(208,175,130,255)],
            // [rgb(206,177,133,255),rgb(208,181,136,255),rgb(213,186,141,255),rgb(211,182,138,255),rgb(201,173,126,255),rgb(204,175,131,255),rgb(206,178,133,255),rgb(210,183,138,255),rgb(211,182,138,255),rgb(210,182,135,255),rgb(203,174,130,255),rgb(210,183,138,255),rgb(210,183,138,255),rgb(206,177,133,255),rgb(206,178,131,255),rgb(209,180,136,255),rgb(211,184,139,255),rgb(214,187,142,255),rgb(212,183,139,255),rgb(211,183,136,255),rgb(206,177,133,255),rgb(216,189,144,255),rgb(221,194,149,255),rgb(216,187,143,255),rgb(207,179,132,255)],
            // [rgb(215,187,147,255),rgb(217,189,149,255),rgb(216,188,148,255),rgb(219,191,151,255),rgb(219,191,151,255),rgb(215,187,147,255),rgb(219,191,151,255),rgb(219,191,151,255),rgb(220,192,152,255),rgb(220,192,152,255),rgb(214,186,147,255),rgb(217,189,149,255),rgb(220,192,152,255),rgb(221,193,153,255),rgb(219,192,149,255),rgb(216,188,149,255),rgb(216,188,148,255),rgb(217,189,149,255),rgb(218,190,150,255),rgb(218,191,148,255),rgb(219,191,152,255),rgb(219,191,151,255),rgb(218,190,150,255),rgb(215,187,147,255),rgb(217,190,147,255)],
            // [rgb(230,209,170,255),rgb(232,210,171,255),rgb(225,203,163,255),rgb(231,209,168,255),rgb(233,210,169,255),rgb(229,209,167,255),rgb(230,208,167,255),rgb(229,207,165,255),rgb(226,203,161,255),rgb(227,204,162,255),rgb(227,206,164,255),rgb(214,193,150,255),rgb(220,198,154,255),rgb(222,199,155,255),rgb(225,202,158,255),rgb(228,206,163,255),rgb(217,196,152,255),rgb(222,200,155,255),rgb(225,202,157,255),rgb(227,203,158,255),rgb(227,203,159,255),rgb(226,204,159,255),rgb(223,202,156,255),rgb(233,210,163,255),rgb(227,203,157,255)]
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)],
            // // [rgb(222,210,150,255),rgb(223,212,150,255),rgb(198,187,123,255),rgb(199,185,120,255),rgb(209,194,127,255),rgb(203,191,131,255),rgb(204,193,130,255),rgb(218,206,142,255),rgb(216,202,137,255),rgb(197,182,115,255),rgb(224,212,152,255),rgb(198,187,124,255),rgb(211,200,136,255),rgb(218,205,138,255),rgb(216,201,134,255),rgb(219,207,147,255),rgb(195,184,120,255),rgb(218,207,142,255),rgb(231,218,151,255),rgb(204,189,120,255),rgb(235,223,162,255),rgb(231,220,157,255),rgb(181,170,104,255),rgb(204,191,124,255),rgb(203,188,119,255)]
            // [rgb(21,15,1,255),rgb(21,15,1,255),rgb(6,4,0,255),rgb(0,0,0,255),rgb(0,0,0,255),rgb(22,16,2,255),rgb(22,16,2,255),rgb(6,5,1,255),rgb(0,0,0,255),rgb(0,0,0,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(7,5,1,255),rgb(0,0,0,255),rgb(0,0,0,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(7,5,1,255),rgb(0,0,0,255),rgb(0,0,0,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(7,5,1,255),rgb(0,0,0,255),rgb(0,0,0,255)],
            // [rgb(26,20,4,255),rgb(25,19,5,255),rgb(24,18,4,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(26,20,4,255),rgb(25,19,5,255),rgb(24,18,4,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(26,20,5,255),rgb(25,19,5,255),rgb(24,18,4,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(27,21,5,255),rgb(25,19,5,255),rgb(24,18,4,255),rgb(23,17,5,255),rgb(23,17,5,255),rgb(27,21,6,255),rgb(26,20,6,255),rgb(24,18,4,255),rgb(23,17,5,255),rgb(22,16,4,255)],
            // [rgb(28,24,5,255),rgb(28,23,6,255),rgb(28,22,6,255),rgb(26,20,5,255),rgb(25,19,5,255),rgb(30,25,6,255),rgb(29,24,7,255),rgb(28,22,6,255),rgb(27,21,5,255),rgb(25,19,5,255),rgb(31,26,7,255),rgb(30,25,7,255),rgb(29,23,7,255),rgb(27,21,6,255),rgb(26,20,6,255),rgb(32,27,8,255),rgb(31,25,8,255),rgb(30,24,8,255),rgb(28,22,6,255),rgb(26,20,6,255),rgb(33,28,9,255),rgb(32,26,9,255),rgb(30,24,8,255),rgb(28,22,7,255),rgb(26,20,6,255)],
            // [rgb(41,37,10,255),rgb(39,35,12,255),rgb(33,29,8,255),rgb(32,27,8,255),rgb(31,25,8,255),rgb(44,40,11,255),rgb(40,36,12,255),rgb(34,29,9,255),rgb(33,28,9,255),rgb(32,26,9,255),rgb(46,40,11,255),rgb(40,36,11,255),rgb(35,29,9,255),rgb(33,28,9,255),rgb(32,26,9,255),rgb(47,41,12,255),rgb(41,35,10,255),rgb(37,30,10,255),rgb(34,28,10,255),rgb(32,26,9,255),rgb(51,45,14,255),rgb(41,35,9,255),rgb(39,32,12,255),rgb(36,29,11,255),rgb(33,26,9,255)],
            // [rgb(65,58,16,255),rgb(52,45,10,255),rgb(46,40,11,255),rgb(40,36,11,255),rgb(35,29,9,255),rgb(69,61,19,255),rgb(53,45,10,255),rgb(47,41,12,255),rgb(41,35,10,255),rgb(37,30,10,255),rgb(71,63,20,255),rgb(55,47,12,255),rgb(51,45,14,255),rgb(41,35,9,255),rgb(39,32,12,255),rgb(73,65,23,255),rgb(58,50,16,255),rgb(51,44,15,255),rgb(42,35,9,255),rgb(38,31,12,255),rgb(70,62,19,255),rgb(56,48,13,255),rgb(50,43,15,255),rgb(39,33,9,255),rgb(37,30,11,255)],
            // [rgb(148,141,78,255),rgb(124,116,59,255),rgb(98,90,40,255),rgb(73,65,23,255),rgb(58,50,16,255),rgb(150,142,80,255),rgb(121,112,55,255),rgb(93,85,35,255),rgb(70,62,19,255),rgb(56,48,13,255),rgb(137,132,69,255),rgb(107,100,44,255),rgb(85,78,29,255),rgb(70,63,22,255),rgb(57,50,16,255),rgb(112,107,45,255),rgb(89,83,27,255),rgb(77,69,24,255),rgb(65,57,20,255),rgb(52,46,15,255),rgb(93,88,29,255),rgb(73,67,14,255),rgb(65,58,14,255),rgb(56,49,14,255),rgb(48,41,12,255)],
            // [rgb(242,238,204,255),rgb(196,193,137,255),rgb(166,163,97,255),rgb(137,132,69,255),rgb(107,100,44,255),rgb(227,223,189,255),rgb(163,162,106,255),rgb(156,153,89,255),rgb(112,107,45,255),rgb(89,83,27,255),rgb(221,218,184,255),rgb(148,147,91,255),rgb(149,147,84,255),rgb(93,88,29,255),rgb(73,67,14,255),rgb(225,222,188,255),rgb(147,146,91,255),rgb(147,146,83,255),rgb(85,81,23,255),rgb(67,61,10,255),rgb(233,231,199,255),rgb(161,160,109,255),rgb(149,147,88,255),rgb(91,86,31,255),rgb(66,60,10,255)],
            // [rgb(253,252,238,255),rgb(248,245,225,255),rgb(221,218,184,255),rgb(148,147,91,255),rgb(149,147,84,255),rgb(254,253,239,255),rgb(251,247,228,255),rgb(225,222,188,255),rgb(147,146,91,255),rgb(147,146,83,255),rgb(252,251,237,255),rgb(252,250,231,255),rgb(233,231,199,255),rgb(161,160,109,255),rgb(149,147,88,255),rgb(250,251,237,255),rgb(251,251,234,255),rgb(241,240,214,255),rgb(185,184,141,255),rgb(149,146,96,255),rgb(251,253,239,255),rgb(250,251,236,255),rgb(246,247,226,255),rgb(209,208,175,255),rgb(146,143,103,255)],
            // [rgb(247,249,230,255),rgb(251,252,237,255),rgb(250,252,238,255),rgb(250,251,237,255),rgb(251,251,234,255),rgb(238,239,216,255),rgb(246,247,229,255),rgb(251,253,238,255),rgb(251,253,239,255),rgb(250,251,236,255),rgb(235,234,206,255),rgb(238,239,215,255),rgb(247,249,230,255),rgb(251,253,236,255),rgb(249,251,235,255),rgb(243,243,207,255),rgb(247,246,215,255),rgb(252,252,226,255),rgb(254,254,232,255),rgb(253,254,232,255),rgb(223,220,177,255),rgb(218,216,176,255),rgb(235,234,198,255),rgb(252,252,223,255),rgb(255,255,232,255)],
            // [rgb(220,219,179,255),rgb(235,237,200,255),rgb(237,236,204,255),rgb(235,234,206,255),rgb(238,239,215,255),rgb(205,203,158,255),rgb(205,205,163,255),rgb(249,247,207,255),rgb(243,243,207,255),rgb(247,246,215,255),rgb(204,202,152,255),rgb(209,207,158,255),rgb(227,225,177,255),rgb(223,220,177,255),rgb(218,216,176,255),rgb(230,228,171,255),rgb(228,226,168,255),rgb(212,207,152,255),rgb(214,209,156,255),rgb(200,196,147,255),rgb(221,217,157,255),rgb(206,202,139,255),rgb(217,211,151,255),rgb(219,212,152,255),rgb(207,201,144,255)]

// [rgb(206,168,99,255),rgb(150,128,70,255),rgb(144,122,64,255),rgb(153,131,73,255),rgb(155,133,75,255),rgb(181,159,99,255),rgb(161,139,80,255),rgb(153,131,71,255),rgb(170,148,90,255),rgb(166,144,86,255),rgb(193,171,111,255),rgb(174,152,92,255),rgb(170,148,88,255),rgb(180,158,100,255),rgb(175,153,95,255),rgb(187,165,105,255),rgb(180,158,98,255),rgb(182,160,100,255),rgb(180,158,99,255),rgb(169,147,89,255),rgb(183,162,102,255),rgb(179,157,97,255),rgb(182,160,100,255),rgb(186,164,105,255),rgb(177,155,96,255)],
// [rgb(191,156,94,255),rgb(168,146,89,255),rgb(165,143,86,255),rgb(169,147,90,255),rgb(159,138,81,255),rgb(178,156,98,255),rgb(179,158,99,255),rgb(165,143,85,255),rgb(166,144,86,255),rgb(166,145,87,255),rgb(168,147,88,255),rgb(186,166,107,255),rgb(190,169,109,255),rgb(178,157,98,255),rgb(166,145,86,255),rgb(183,164,103,255),rgb(156,137,76,255),rgb(158,139,77,255),rgb(162,142,81,255),rgb(142,122,63,255),rgb(182,164,102,255),rgb(178,160,98,255),rgb(166,148,86,255),rgb(183,165,103,255),rgb(177,158,98,255)],
// [rgb(171,141,89,255),rgb(147,126,71,255),rgb(142,121,66,255),rgb(136,113,60,255),rgb(127,104,52,255),rgb(150,129,72,255),rgb(150,129,73,255),rgb(155,134,79,255),rgb(149,126,73,255),rgb(139,116,64,255),rgb(145,124,67,255),rgb(139,118,62,255),rgb(150,129,74,255),rgb(157,135,82,255),rgb(155,133,80,255),rgb(142,121,64,255),rgb(137,116,60,255),rgb(146,125,70,255),rgb(164,142,89,255),rgb(170,147,95,255),rgb(152,131,74,255),rgb(155,134,78,255),rgb(160,139,84,255),rgb(166,144,90,255),rgb(168,145,92,255)],
// [rgb(158,131,82,255),rgb(158,135,85,255),rgb(157,134,85,255),rgb(135,111,63,255),rgb(133,109,60,255),rgb(162,139,87,255),rgb(154,131,79,255),rgb(133,110,60,255),rgb(137,114,64,255),rgb(144,121,71,255),rgb(167,144,92,255),rgb(164,141,89,255),rgb(144,121,70,255),rgb(140,117,66,255),rgb(143,120,70,255),rgb(167,144,92,255),rgb(156,133,81,255),rgb(143,121,69,255),rgb(135,112,60,255),rgb(132,109,58,255),rgb(168,145,93,255),rgb(155,132,80,255),rgb(143,120,68,255),rgb(143,120,68,255),rgb(141,118,66,255)],
// [rgb(143,119,76,255),rgb(125,100,52,255),rgb(127,102,55,255),rgb(132,107,61,255),rgb(129,105,60,255),rgb(143,117,69,255),rgb(127,100,52,255),rgb(130,103,56,255),rgb(139,114,67,255),rgb(138,114,68,255),rgb(145,119,70,255),rgb(135,108,60,255),rgb(134,107,60,255),rgb(144,119,72,255),rgb(140,115,69,255),rgb(136,110,61,255),rgb(143,117,68,255),rgb(139,112,65,255),rgb(143,117,71,255),rgb(140,115,69,255),rgb(123,96,47,255),rgb(146,120,71,255),rgb(148,122,72,255),rgb(135,108,60,255),rgb(126,101,53,255)],
// [rgb(138,112,65,255),rgb(144,120,75,255),rgb(149,126,81,255),rgb(126,102,58,255),rgb(110,86,43,255),rgb(111,86,38,255),rgb(134,110,64,255),rgb(143,120,74,255),rgb(121,97,53,255),rgb(99,76,32,255),rgb(119,95,46,255),rgb(127,103,56,255),rgb(136,112,66,255),rgb(131,107,62,255),rgb(129,105,61,255),rgb(144,119,71,255),rgb(134,110,62,255),rgb(123,99,53,255),rgb(118,94,49,255),rgb(120,96,52,255),rgb(141,116,68,255),rgb(125,101,53,255),rgb(121,97,50,255),rgb(112,88,43,255),rgb(108,84,39,255)],
// [rgb(130,105,60,255),rgb(94,70,26,255),rgb(97,73,31,255),rgb(108,84,43,255),rgb(107,83,43,255),rgb(102,78,33,255),rgb(87,63,18,255),rgb(100,75,32,255),rgb(109,85,42,255),rgb(107,82,41,255),rgb(116,92,45,255),rgb(112,87,41,255),rgb(127,103,57,255),rgb(130,105,61,255),rgb(122,97,54,255),rgb(128,101,53,255),rgb(144,117,70,255),rgb(152,125,79,255),rgb(142,115,70,255),rgb(124,97,52,255),rgb(132,106,57,255),rgb(141,115,66,255),rgb(122,96,48,255),rgb(98,72,24,255),rgb(91,64,17,255)],
// [rgb(121,98,55,255),rgb(124,99,61,255),rgb(113,88,51,255),rgb(109,85,49,255),rgb(103,79,44,255),rgb(127,102,60,255),rgb(124,99,58,255),rgb(113,89,50,255),rgb(106,82,45,255),rgb(97,73,37,255),rgb(132,106,63,255),rgb(121,96,55,255),rgb(107,83,43,255),rgb(104,80,42,255),rgb(103,80,44,255),rgb(128,102,58,255),rgb(119,95,53,255),rgb(105,81,41,255),rgb(103,79,41,255),rgb(105,81,45,255),rgb(119,94,50,255),rgb(112,88,46,255),rgb(111,86,46,255),rgb(111,86,48,255),rgb(107,84,46,255)],
// [rgb(111,90,52,255),rgb(83,62,28,255),rgb(90,69,36,255),rgb(96,74,42,255),rgb(92,70,38,255),rgb(80,58,24,255),rgb(84,62,29,255),rgb(93,70,38,255),rgb(96,73,41,255),rgb(89,66,33,255),rgb(79,55,22,255),rgb(81,56,26,255),rgb(82,58,27,255),rgb(81,58,26,255),rgb(79,56,24,255),rgb(98,73,41,255),rgb(94,69,38,255),rgb(88,63,32,255),rgb(81,57,25,255),rgb(78,54,21,255),rgb(103,79,46,255),rgb(88,64,32,255),rgb(79,54,23,255),rgb(76,51,19,255),rgb(74,50,17,255)],
// [rgb(97,78,45,255),rgb(92,68,40,255),rgb(89,65,39,255),rgb(87,63,38,255),rgb(87,63,38,255),rgb(76,53,24,255),rgb(82,58,30,255),rgb(81,57,30,255),rgb(73,49,24,255),rgb(69,45,20,255),rgb(72,48,19,255),rgb(72,47,19,255),rgb(70,45,19,255),rgb(65,41,15,255),rgb(62,38,13,255),rgb(80,55,24,255),rgb(72,47,19,255),rgb(70,45,18,255),rgb(71,47,21,255),rgb(71,47,23,255),rgb(91,66,35,255),rgb(80,55,26,255),rgb(75,51,23,255),rgb(77,53,27,255),rgb(79,55,31,255)]


// [rgb(209,189,127,255),rgb(208,191,130,255),rgb(191,175,115,255),rgb(193,178,119,255),rgb(199,183,124,255),rgb(185,166,103,255),rgb(184,166,105,255),rgb(186,170,111,255),rgb(200,184,125,255),rgb(218,203,143,255),rgb(188,168,105,255),rgb(191,172,110,255),rgb(186,170,110,255),rgb(185,169,109,255),rgb(187,172,113,255),rgb(180,160,97,255),rgb(178,158,96,255),rgb(191,173,111,255),rgb(203,185,123,255),rgb(190,175,114,255),rgb(163,143,80,255),rgb(164,144,81,255),rgb(174,154,91,255),rgb(194,175,112,255),rgb(207,191,127,255)],
// [rgb(185,166,103,255),rgb(184,166,105,255),rgb(186,170,111,255),rgb(200,184,125,255),rgb(218,203,143,255),rgb(188,168,105,255),rgb(191,172,110,255),rgb(186,170,110,255),rgb(185,169,109,255),rgb(187,172,113,255),rgb(180,160,97,255),rgb(178,158,96,255),rgb(191,173,111,255),rgb(203,185,123,255),rgb(190,175,114,255),rgb(163,143,80,255),rgb(164,144,81,255),rgb(174,154,91,255),rgb(194,175,112,255),rgb(207,191,127,255),rgb(185,165,102,255),rgb(157,136,72,255),rgb(184,163,98,255),rgb(179,160,96,255),rgb(188,170,106,255)],
// [rgb(188,168,105,255),rgb(191,172,110,255),rgb(186,170,110,255),rgb(185,169,109,255),rgb(187,172,113,255),rgb(180,160,97,255),rgb(178,158,96,255),rgb(191,173,111,255),rgb(203,185,123,255),rgb(190,175,114,255),rgb(163,143,80,255),rgb(164,144,81,255),rgb(174,154,91,255),rgb(194,175,112,255),rgb(207,191,127,255),rgb(185,165,102,255),rgb(157,136,72,255),rgb(184,163,98,255),rgb(179,160,96,255),rgb(188,170,106,255),rgb(171,151,88,255),rgb(158,136,73,255),rgb(177,155,88,255),rgb(181,161,95,255),rgb(189,171,106,255)],
// [rgb(164,144,81,255),rgb(174,154,91,255),rgb(194,175,112,255),rgb(207,191,127,255),rgb(205,190,128,255),rgb(157,136,72,255),rgb(184,163,98,255),rgb(179,160,96,255),rgb(188,170,106,255),rgb(194,179,115,255),rgb(158,136,73,255),rgb(177,155,88,255),rgb(181,161,95,255),rgb(189,171,106,255),rgb(205,190,126,255),rgb(165,143,79,255),rgb(159,134,70,255),rgb(178,155,91,255),rgb(178,158,94,255),rgb(175,156,93,255),rgb(181,158,95,255),rgb(176,152,88,255),rgb(170,147,84,255),rgb(155,134,70,255),rgb(177,157,95,255)],
// [rgb(157,136,72,255),rgb(184,163,98,255),rgb(179,160,96,255),rgb(188,170,106,255),rgb(194,179,115,255),rgb(158,136,73,255),rgb(177,155,88,255),rgb(181,161,95,255),rgb(189,171,106,255),rgb(205,190,126,255),rgb(165,143,79,255),rgb(159,134,70,255),rgb(178,155,91,255),rgb(178,158,94,255),rgb(175,156,93,255),rgb(181,158,95,255),rgb(176,152,88,255),rgb(170,147,84,255),rgb(155,134,70,255),rgb(177,157,95,255),rgb(180,158,95,255),rgb(181,157,94,255),rgb(165,143,80,255),rgb(156,135,72,255),rgb(167,148,85,255)],
// [rgb(159,134,70,255),rgb(178,155,91,255),rgb(178,158,94,255),rgb(175,156,93,255),rgb(177,160,98,255),rgb(176,152,88,255),rgb(170,147,84,255),rgb(155,134,70,255),rgb(177,157,95,255),rgb(176,158,96,255),rgb(181,157,94,255),rgb(165,143,80,255),rgb(156,135,72,255),rgb(167,148,85,255),rgb(171,153,91,255),rgb(148,124,62,255),rgb(166,143,80,255),rgb(157,137,74,255),rgb(161,141,79,255),rgb(162,144,82,255),rgb(140,116,56,255),rgb(169,147,87,255),rgb(174,153,92,255),rgb(155,136,74,255),rgb(138,120,58,255)],
// [rgb(176,152,88,255),rgb(170,147,84,255),rgb(155,134,70,255),rgb(177,157,95,255),rgb(176,158,96,255),rgb(181,157,94,255),rgb(165,143,80,255),rgb(156,135,72,255),rgb(167,148,85,255),rgb(171,153,91,255),rgb(148,124,62,255),rgb(166,143,80,255),rgb(157,137,74,255),rgb(161,141,79,255),rgb(162,144,82,255),rgb(140,116,56,255),rgb(169,147,87,255),rgb(174,153,92,255),rgb(155,136,74,255),rgb(138,120,58,255),rgb(152,127,69,255),rgb(145,123,64,255),rgb(163,142,83,255),rgb(175,156,96,255),rgb(153,134,72,255)],
// [rgb(165,143,80,255),rgb(156,135,72,255),rgb(167,148,85,255),rgb(171,153,91,255),rgb(186,169,109,255),rgb(166,143,80,255),rgb(157,137,74,255),rgb(161,141,79,255),rgb(162,144,82,255),rgb(182,163,103,255),rgb(169,147,87,255),rgb(174,153,92,255),rgb(155,136,74,255),rgb(138,120,58,255),rgb(151,133,71,255),rgb(145,123,64,255),rgb(163,142,83,255),rgb(175,156,96,255),rgb(153,134,72,255),rgb(160,142,80,255),rgb(143,121,63,255),rgb(149,128,69,255),rgb(141,121,61,255),rgb(157,137,76,255),rgb(174,155,93,255)],
// [rgb(169,147,87,255),rgb(174,153,92,255),rgb(155,136,74,255),rgb(138,120,58,255),rgb(151,133,71,255),rgb(145,123,64,255),rgb(163,142,83,255),rgb(175,156,96,255),rgb(153,134,72,255),rgb(160,142,80,255),rgb(143,121,63,255),rgb(149,128,69,255),rgb(141,121,61,255),rgb(157,137,76,255),rgb(174,155,93,255),rgb(169,147,89,255),rgb(161,140,81,255),rgb(144,123,65,255),rgb(162,142,83,255),rgb(179,159,99,255),rgb(173,150,93,255),rgb(144,123,65,255),rgb(149,129,70,255),rgb(161,141,82,255),rgb(164,144,83,255)],
// [rgb(163,142,83,255),rgb(175,156,96,255),rgb(153,134,72,255),rgb(160,142,80,255),rgb(164,145,84,255),rgb(149,128,69,255),rgb(141,121,61,255),rgb(157,137,76,255),rgb(174,155,93,255),rgb(177,158,96,255),rgb(161,140,81,255),rgb(144,123,65,255),rgb(162,142,83,255),rgb(179,159,99,255),rgb(165,145,83,255),rgb(144,123,65,255),rgb(149,129,70,255),rgb(161,141,82,255),rgb(164,144,83,255),rgb(190,169,108,255),rgb(149,128,71,255),rgb(145,125,67,255),rgb(160,140,81,255),rgb(162,142,82,255),rgb(164,143,81,255)],
// [rgb(161,140,81,255),rgb(144,123,65,255),rgb(162,142,83,255),rgb(179,159,99,255),rgb(165,145,83,255),rgb(144,123,65,255),rgb(149,129,70,255),rgb(161,141,82,255),rgb(164,144,83,255),rgb(190,169,108,255),rgb(149,128,71,255),rgb(145,125,67,255),rgb(160,140,81,255),rgb(162,142,82,255),rgb(164,143,81,255),rgb(152,131,74,255),rgb(161,141,83,255),rgb(130,110,51,255),rgb(154,134,74,255),rgb(132,112,51,255),rgb(140,119,63,255),rgb(147,126,69,255),rgb(139,117,60,255),rgb(162,140,82,255),rgb(166,144,86,255)],
// [rgb(149,129,70,255),rgb(161,141,82,255),rgb(164,144,83,255),rgb(190,169,108,255),rgb(150,129,66,255),rgb(145,125,67,255),rgb(160,140,81,255),rgb(162,142,82,255),rgb(164,143,81,255),rgb(174,153,90,255),rgb(161,141,83,255),rgb(130,110,51,255),rgb(154,134,74,255),rgb(132,112,51,255),rgb(140,118,56,255),rgb(147,126,69,255),rgb(139,117,60,255),rgb(162,140,82,255),rgb(166,144,86,255),rgb(163,141,82,255),rgb(137,116,59,255),rgb(178,156,99,255),rgb(155,133,75,255),rgb(145,123,65,255),rgb(128,106,48,255)],
// [rgb(145,125,67,255),rgb(160,140,81,255),rgb(162,142,82,255),rgb(164,143,81,255),rgb(174,153,90,255),rgb(161,141,83,255),rgb(130,110,51,255),rgb(154,134,74,255),rgb(132,112,51,255),rgb(140,118,56,255),rgb(147,126,69,255),rgb(139,117,60,255),rgb(162,140,82,255),rgb(166,144,86,255),rgb(163,141,82,255),rgb(137,116,59,255),rgb(178,156,99,255),rgb(155,133,75,255),rgb(145,123,65,255),rgb(128,106,48,255),rgb(144,122,66,255),rgb(164,142,85,255),rgb(138,116,59,255),rgb(166,144,87,255),rgb(157,135,77,255)],
// [rgb(139,117,60,255),rgb(162,140,82,255),rgb(166,144,86,255),rgb(163,141,82,255),rgb(161,139,78,255),rgb(178,156,99,255),rgb(155,133,75,255),rgb(145,123,65,255),rgb(128,106,48,255),rgb(138,116,58,255),rgb(164,142,85,255),rgb(138,116,59,255),rgb(166,144,87,255),rgb(157,135,77,255),rgb(137,115,57,255),rgb(141,119,62,255),rgb(164,142,85,255),rgb(184,162,105,255),rgb(169,147,89,255),rgb(141,119,61,255),rgb(152,129,75,255),rgb(136,114,57,255),rgb(100,78,21,255),rgb(142,120,63,255),rgb(149,127,69,255)],
// [rgb(178,156,99,255),rgb(155,133,75,255),rgb(145,123,65,255),rgb(128,106,48,255),rgb(138,116,58,255),rgb(164,142,85,255),rgb(138,116,59,255),rgb(166,144,87,255),rgb(157,135,77,255),rgb(137,115,57,255),rgb(141,119,62,255),rgb(164,142,85,255),rgb(184,162,105,255),rgb(169,147,89,255),rgb(141,119,61,255),rgb(152,129,75,255),rgb(136,114,57,255),rgb(100,78,21,255),rgb(142,120,63,255),rgb(149,127,69,255),rgb(128,105,51,255),rgb(139,116,62,255),rgb(120,98,42,255),rgb(108,86,29,255),rgb(141,119,62,255)],
// [rgb(164,142,85,255),rgb(184,162,105,255),rgb(169,147,89,255),rgb(141,119,61,255),rgb(154,132,74,255),rgb(136,114,57,255),rgb(100,78,21,255),rgb(142,120,63,255),rgb(149,127,69,255),rgb(151,129,71,255),rgb(139,116,62,255),rgb(120,98,42,255),rgb(108,86,29,255),rgb(141,119,62,255),rgb(141,119,62,255),rgb(139,116,62,255),rgb(141,118,63,255),rgb(145,122,66,255),rgb(140,118,61,255),rgb(124,102,45,255),rgb(122,99,46,255),rgb(123,100,46,255),rgb(129,107,52,255),rgb(137,115,58,255),rgb(125,103,46,255)],
// [rgb(136,114,57,255),rgb(100,78,21,255),rgb(142,120,63,255),rgb(149,127,69,255),rgb(151,129,71,255),rgb(139,116,62,255),rgb(120,98,42,255),rgb(108,86,29,255),rgb(141,119,62,255),rgb(141,119,62,255),rgb(139,116,62,255),rgb(141,118,63,255),rgb(145,122,66,255),rgb(140,118,61,255),rgb(124,102,45,255),rgb(122,99,46,255),rgb(123,100,46,255),rgb(129,107,52,255),rgb(137,115,58,255),rgb(125,103,46,255),rgb(148,125,73,255),rgb(141,118,64,255),rgb(118,95,41,255),rgb(137,114,60,255),rgb(145,122,68,255)],
// [rgb(139,116,62,255),rgb(120,98,42,255),rgb(108,86,29,255),rgb(141,119,62,255),rgb(141,119,62,255),rgb(139,116,62,255),rgb(141,118,63,255),rgb(145,122,66,255),rgb(140,118,61,255),rgb(124,102,45,255),rgb(122,99,46,255),rgb(123,100,46,255),rgb(129,107,52,255),rgb(137,115,58,255),rgb(125,103,46,255),rgb(148,125,73,255),rgb(141,118,64,255),rgb(118,95,41,255),rgb(137,114,60,255),rgb(145,122,68,255),rgb(149,126,74,255),rgb(114,91,37,255),rgb(132,109,55,255),rgb(138,115,61,255),rgb(133,110,56,255)],
// [rgb(123,100,46,255),rgb(129,107,52,255),rgb(137,115,58,255),rgb(125,103,46,255),rgb(139,117,60,255),rgb(141,118,64,255),rgb(118,95,41,255),rgb(137,114,60,255),rgb(145,122,68,255),rgb(147,124,69,255),rgb(114,91,37,255),rgb(132,109,55,255),rgb(138,115,61,255),rgb(133,110,56,255),rgb(147,124,69,255),rgb(119,96,45,255),rgb(127,105,52,255),rgb(119,97,44,255),rgb(131,109,55,255),rgb(141,119,63,255),rgb(152,130,80,255),rgb(129,107,56,255),rgb(129,108,56,255),rgb(122,101,47,255),rgb(144,122,67,255)],
// [rgb(141,118,64,255),rgb(118,95,41,255),rgb(137,114,60,255),rgb(145,122,68,255),rgb(147,124,69,255),rgb(114,91,37,255),rgb(132,109,55,255),rgb(138,115,61,255),rgb(133,110,56,255),rgb(147,124,69,255),rgb(119,96,45,255),rgb(127,105,52,255),rgb(119,97,44,255),rgb(131,109,55,255),rgb(141,119,63,255),rgb(152,130,80,255),rgb(129,107,56,255),rgb(129,108,56,255),rgb(122,101,47,255),rgb(144,122,67,255),rgb(108,86,36,255),rgb(119,97,47,255),rgb(130,109,56,255),rgb(120,99,46,255),rgb(131,109,55,255)],
// [rgb(127,105,52,255),rgb(119,97,44,255),rgb(131,109,55,255),rgb(141,119,63,255),rgb(129,107,50,255),rgb(129,107,56,255),rgb(129,108,56,255),rgb(122,101,47,255),rgb(144,122,67,255),rgb(143,120,64,255),rgb(119,97,47,255),rgb(130,109,56,255),rgb(120,99,46,255),rgb(131,109,55,255),rgb(138,115,61,255),rgb(111,89,39,255),rgb(105,83,33,255),rgb(136,114,64,255),rgb(148,125,75,255),rgb(151,129,77,255),rgb(138,116,66,255),rgb(129,107,57,255),rgb(136,114,64,255),rgb(141,118,68,255),rgb(131,108,59,255)],
// [rgb(129,107,56,255),rgb(129,108,56,255),rgb(122,101,47,255),rgb(144,122,67,255),rgb(143,120,64,255),rgb(119,97,47,255),rgb(130,109,56,255),rgb(120,99,46,255),rgb(131,109,55,255),rgb(138,115,61,255),rgb(111,89,39,255),rgb(105,83,33,255),rgb(136,114,64,255),rgb(148,125,75,255),rgb(151,129,77,255),rgb(138,116,66,255),rgb(129,107,57,255),rgb(136,114,64,255),rgb(141,118,68,255),rgb(131,108,59,255),rgb(132,110,61,255),rgb(126,104,54,255),rgb(122,100,51,255),rgb(121,98,51,255),rgb(132,108,62,255)],
// [rgb(130,109,56,255),rgb(120,99,46,255),rgb(131,109,55,255),rgb(138,115,61,255),rgb(128,105,52,255),rgb(105,83,33,255),rgb(136,114,64,255),rgb(148,125,75,255),rgb(151,129,77,255),rgb(152,129,78,255),rgb(129,107,57,255),rgb(136,114,64,255),rgb(141,118,68,255),rgb(131,108,59,255),rgb(146,122,73,255),rgb(126,104,54,255),rgb(122,100,51,255),rgb(121,98,51,255),rgb(132,108,62,255),rgb(112,88,40,255),rgb(124,102,53,255),rgb(126,104,55,255),rgb(131,108,61,255),rgb(146,122,76,255),rgb(134,110,64,255)],
// [rgb(129,107,57,255),rgb(136,114,64,255),rgb(141,118,68,255),rgb(131,108,59,255),rgb(146,122,73,255),rgb(126,104,54,255),rgb(122,100,51,255),rgb(121,98,51,255),rgb(132,108,62,255),rgb(112,88,40,255),rgb(124,102,53,255),rgb(126,104,55,255),rgb(131,108,61,255),rgb(146,122,76,255),rgb(134,110,64,255),rgb(104,82,35,255),rgb(104,82,35,255),rgb(84,61,16,255),rgb(108,84,40,255),rgb(126,102,58,255),rgb(111,88,42,255),rgb(98,76,30,255),rgb(105,83,38,255),rgb(134,110,66,255),rgb(127,103,59,255)],
// [rgb(122,100,51,255),rgb(121,98,51,255),rgb(132,108,62,255),rgb(112,88,40,255),rgb(117,93,45,255),rgb(126,104,55,255),rgb(131,108,61,255),rgb(146,122,76,255),rgb(134,110,64,255),rgb(122,98,52,255),rgb(104,82,35,255),rgb(84,61,16,255),rgb(108,84,40,255),rgb(126,102,58,255),rgb(138,114,69,255),rgb(98,76,30,255),rgb(105,83,38,255),rgb(134,110,66,255),rgb(127,103,59,255),rgb(144,120,74,255),rgb(111,88,44,255),rgb(128,105,61,255),rgb(122,98,54,255),rgb(120,96,52,255),rgb(139,115,70,255)],
// [rgb(104,82,35,255),rgb(84,61,16,255),rgb(108,84,40,255),rgb(126,102,58,255),rgb(138,114,69,255),rgb(98,76,30,255),rgb(105,83,38,255),rgb(134,110,66,255),rgb(127,103,59,255),rgb(144,120,74,255),rgb(111,88,44,255),rgb(128,105,61,255),rgb(122,98,54,255),rgb(120,96,52,255),rgb(139,115,70,255),rgb(106,83,39,255),rgb(92,68,24,255),rgb(104,80,36,255),rgb(111,87,42,255),rgb(122,98,53,255),rgb(94,70,25,255),rgb(87,63,20,255),rgb(116,91,49,255),rgb(115,90,49,255),rgb(116,92,50,255)],
// [rgb(105,83,38,255),rgb(134,110,66,255),rgb(127,103,59,255),rgb(144,120,74,255),rgb(161,136,90,255),rgb(128,105,61,255),rgb(122,98,54,255),rgb(120,96,52,255),rgb(139,115,70,255),rgb(117,92,46,255),rgb(92,68,24,255),rgb(104,80,36,255),rgb(111,87,42,255),rgb(122,98,53,255),rgb(118,93,48,255),rgb(87,63,20,255),rgb(116,91,49,255),rgb(115,90,49,255),rgb(116,92,50,255),rgb(122,97,55,255),rgb(89,64,21,255),rgb(118,93,53,255),rgb(96,71,31,255),rgb(102,77,37,255),rgb(98,73,33,255)],
// [rgb(128,105,61,255),rgb(122,98,54,255),rgb(120,96,52,255),rgb(139,115,70,255),rgb(117,92,46,255),rgb(92,68,24,255),rgb(104,80,36,255),rgb(111,87,42,255),rgb(122,98,53,255),rgb(118,93,48,255),rgb(87,63,20,255),rgb(116,91,49,255),rgb(115,90,49,255),rgb(116,92,50,255),rgb(122,97,55,255),rgb(89,64,21,255),rgb(118,93,53,255),rgb(96,71,31,255),rgb(102,77,37,255),rgb(98,73,33,255),rgb(99,74,32,255),rgb(107,82,42,255),rgb(111,86,46,255),rgb(136,111,71,255),rgb(115,90,50,255)],
// [rgb(116,91,49,255),rgb(115,90,49,255),rgb(116,92,50,255),rgb(122,97,55,255),rgb(106,82,40,255),rgb(118,93,53,255),rgb(96,71,31,255),rgb(102,77,37,255),rgb(98,73,33,255),rgb(114,89,49,255),rgb(107,82,42,255),rgb(111,86,46,255),rgb(136,111,71,255),rgb(115,90,50,255),rgb(104,79,39,255),rgb(110,87,45,255),rgb(100,75,35,255),rgb(97,72,32,255),rgb(121,96,56,255),rgb(110,85,45,255),rgb(116,93,51,255),rgb(86,63,21,255),rgb(92,69,28,255),rgb(103,79,38,255),rgb(100,75,35,255)],
// [rgb(118,93,53,255),rgb(96,71,31,255),rgb(102,77,37,255),rgb(98,73,33,255),rgb(114,89,49,255),rgb(107,82,42,255),rgb(111,86,46,255),rgb(136,111,71,255),rgb(115,90,50,255),rgb(104,79,39,255),rgb(110,87,45,255),rgb(100,75,35,255),rgb(97,72,32,255),rgb(121,96,56,255),rgb(110,85,45,255),rgb(116,93,51,255),rgb(86,63,21,255),rgb(92,69,28,255),rgb(103,79,38,255),rgb(100,75,35,255),rgb(110,87,45,255),rgb(123,100,58,255),rgb(95,72,31,255),rgb(100,77,36,255),rgb(105,81,40,255)]

// [rgb(228,219,188,255),rgb(219,210,177,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(213,204,171,255),rgb(215,206,173,255),rgb(221,212,179,255),rgb(218,209,176,255),rgb(220,209,177,255),rgb(212,201,169,255),rgb(219,210,177,255),rgb(218,209,176,255),rgb(216,207,174,255),rgb(216,205,173,255),rgb(213,202,170,255),rgb(219,210,177,255),rgb(222,213,180,255),rgb(218,209,176,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(213,204,171,255),rgb(214,205,172,255),rgb(214,205,172,255),rgb(207,196,164,255),rgb(203,192,160,255)],
// [rgb(218,209,178,255),rgb(213,204,171,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(210,201,168,255),rgb(223,214,182,255),rgb(215,206,173,255),rgb(219,210,177,255),rgb(221,212,179,255),rgb(213,204,171,255),rgb(228,219,188,255),rgb(219,210,177,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(213,204,171,255),rgb(215,206,173,255),rgb(221,212,179,255),rgb(218,209,176,255),rgb(220,209,177,255),rgb(212,201,169,255),rgb(219,210,177,255),rgb(218,209,176,255),rgb(216,207,174,255),rgb(216,205,173,255),rgb(213,202,170,255)],
// [rgb(221,212,181,255),rgb(218,209,178,255),rgb(218,209,178,255),rgb(211,202,171,255),rgb(212,203,172,255),rgb(211,202,171,255),rgb(218,209,177,255),rgb(224,215,183,255),rgb(211,202,170,255),rgb(216,207,176,255),rgb(213,204,171,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(210,201,168,255),rgb(214,204,172,255),rgb(215,206,173,255),rgb(219,210,177,255),rgb(221,212,179,255),rgb(213,204,171,255),rgb(214,204,172,255),rgb(219,210,177,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(213,204,171,255),rgb(208,197,165,255)],
// [rgb(220,211,180,255),rgb(218,209,178,255),rgb(225,216,185,255),rgb(217,208,177,255),rgb(220,211,180,255),rgb(221,212,181,255),rgb(218,209,178,255),rgb(218,209,178,255),rgb(211,202,171,255),rgb(212,203,172,255),rgb(211,202,171,255),rgb(218,209,177,255),rgb(224,215,183,255),rgb(211,202,170,255),rgb(216,207,176,255),rgb(213,204,171,255),rgb(225,216,183,255),rgb(218,209,176,255),rgb(210,201,168,255),rgb(214,204,172,255),rgb(215,206,173,255),rgb(219,210,177,255),rgb(221,212,179,255),rgb(213,204,171,255),rgb(214,204,172,255)],
// [rgb(206,197,164,255),rgb(216,207,176,255),rgb(232,223,192,255),rgb(212,202,170,255),rgb(215,204,172,255),rgb(216,207,175,255),rgb(218,209,178,255),rgb(216,207,176,255),rgb(214,204,172,255),rgb(218,208,176,255),rgb(218,209,178,255),rgb(225,216,185,255),rgb(217,208,177,255),rgb(220,211,180,255),rgb(216,207,176,255),rgb(218,209,178,255),rgb(218,209,178,255),rgb(211,202,171,255),rgb(212,203,172,255),rgb(214,205,174,255),rgb(218,209,177,255),rgb(224,215,183,255),rgb(211,202,170,255),rgb(216,207,176,255),rgb(216,206,175,255)],
// [rgb(220,211,178,255),rgb(222,213,182,255),rgb(220,211,180,255),rgb(213,203,171,255),rgb(210,199,167,255),rgb(206,197,164,255),rgb(216,207,176,255),rgb(232,223,192,255),rgb(212,202,170,255),rgb(215,204,172,255),rgb(216,207,175,255),rgb(218,209,178,255),rgb(216,207,176,255),rgb(214,204,172,255),rgb(218,208,176,255),rgb(218,209,178,255),rgb(225,216,185,255),rgb(217,208,177,255),rgb(220,211,180,255),rgb(216,207,176,255),rgb(218,209,178,255),rgb(218,209,178,255),rgb(211,202,171,255),rgb(212,203,172,255),rgb(214,205,174,255)],
// [rgb(224,215,182,255),rgb(212,203,170,255),rgb(221,212,180,255),rgb(222,213,182,255),rgb(218,209,178,255),rgb(218,209,177,255),rgb(216,207,175,255),rgb(225,216,184,255),rgb(212,202,170,255),rgb(215,205,173,255),rgb(222,213,182,255),rgb(220,211,180,255),rgb(213,203,171,255),rgb(210,199,167,255),rgb(221,210,178,255),rgb(216,207,176,255),rgb(232,223,192,255),rgb(212,202,170,255),rgb(215,204,172,255),rgb(206,195,163,255),rgb(218,209,178,255),rgb(216,207,176,255),rgb(214,204,172,255),rgb(218,208,176,255),rgb(220,210,178,255)],
// [rgb(228,219,186,255),rgb(220,211,178,255),rgb(221,212,180,255),rgb(221,212,181,255),rgb(218,209,178,255),rgb(224,215,182,255),rgb(212,203,170,255),rgb(221,212,180,255),rgb(222,213,182,255),rgb(218,209,178,255),rgb(218,209,177,255),rgb(216,207,175,255),rgb(225,216,184,255),rgb(212,202,170,255),rgb(215,205,173,255),rgb(222,213,182,255),rgb(220,211,180,255),rgb(213,203,171,255),rgb(210,199,167,255),rgb(221,210,178,255),rgb(216,207,176,255),rgb(232,223,192,255),rgb(212,202,170,255),rgb(215,204,172,255),rgb(206,195,163,255)],
// [rgb(216,207,174,255),rgb(219,210,177,255),rgb(214,205,172,255),rgb(216,207,174,255),rgb(213,204,171,255),rgb(219,210,177,255),rgb(222,213,182,255),rgb(222,213,182,255),rgb(223,214,183,255),rgb(220,209,179,255),rgb(220,211,178,255),rgb(221,212,180,255),rgb(221,212,181,255),rgb(218,209,178,255),rgb(211,200,170,255),rgb(212,203,170,255),rgb(221,212,180,255),rgb(222,213,182,255),rgb(218,209,178,255),rgb(207,196,166,255),rgb(216,207,175,255),rgb(225,216,184,255),rgb(212,202,170,255),rgb(215,205,173,255),rgb(207,196,164,255)],
// [rgb(218,209,176,255),rgb(215,206,173,255),rgb(220,211,178,255),rgb(213,204,171,255),rgb(216,207,174,255),rgb(222,213,180,255),rgb(218,209,176,255),rgb(217,208,175,255),rgb(217,208,175,255),rgb(215,206,173,255),rgb(219,210,177,255),rgb(214,205,172,255),rgb(216,207,174,255),rgb(213,204,171,255),rgb(211,202,169,255),rgb(222,213,182,255),rgb(222,213,182,255),rgb(223,214,183,255),rgb(220,209,179,255),rgb(216,206,175,255),rgb(221,212,180,255),rgb(221,212,181,255),rgb(218,209,178,255),rgb(211,200,170,255),rgb(209,198,168,255)]
// [rgb(220,211,178,255),rgb(224,215,182,255),rgb(217,208,175,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(218,209,176,255),rgb(215,206,173,255),rgb(220,211,178,255),rgb(213,204,171,255),rgb(216,207,174,255),rgb(222,213,180,255),rgb(218,209,176,255),rgb(217,208,175,255),rgb(217,208,175,255),rgb(215,206,173,255),rgb(219,210,177,255),rgb(214,205,172,255),rgb(216,207,174,255),rgb(213,204,171,255),rgb(211,202,169,255),rgb(222,213,182,255),rgb(222,213,182,255),rgb(223,214,183,255),rgb(220,209,179,255),rgb(216,206,175,255)],
// [rgb(220,211,178,255),rgb(213,204,171,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(218,207,175,255),rgb(213,204,171,255),rgb(214,205,172,255),rgb(218,207,175,255),rgb(206,195,163,255),rgb(228,217,185,255),rgb(224,215,182,255),rgb(217,208,175,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(220,209,177,255),rgb(215,206,173,255),rgb(220,211,178,255),rgb(213,204,171,255),rgb(216,207,174,255),rgb(212,201,169,255),rgb(218,209,176,255),rgb(217,208,175,255),rgb(217,208,175,255),rgb(215,206,173,255),rgb(210,199,167,255)],
// [rgb(217,208,175,255),rgb(226,217,184,255),rgb(216,206,171,255),rgb(215,205,170,255),rgb(211,200,168,255),rgb(220,211,178,255),rgb(213,204,171,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(218,207,175,255),rgb(213,204,171,255),rgb(214,205,172,255),rgb(218,207,175,255),rgb(206,195,163,255),rgb(228,217,185,255),rgb(224,215,182,255),rgb(217,208,175,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(220,209,177,255),rgb(215,206,173,255),rgb(220,211,178,255),rgb(213,204,171,255),rgb(216,207,174,255),rgb(212,201,169,255)],
// [rgb(220,211,178,255),rgb(211,201,166,255),rgb(214,204,169,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(229,220,187,255),rgb(211,201,166,255),rgb(216,206,171,255),rgb(218,207,175,255),rgb(222,211,179,255),rgb(226,217,184,255),rgb(216,206,171,255),rgb(215,205,170,255),rgb(211,200,168,255),rgb(200,189,157,255),rgb(213,204,171,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(218,207,175,255),rgb(213,202,170,255),rgb(214,205,172,255),rgb(218,207,175,255),rgb(206,195,163,255),rgb(228,217,185,255),rgb(221,210,178,255)],
// [rgb(220,211,178,255),rgb(213,202,169,255),rgb(211,200,167,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(220,211,178,255),rgb(211,201,166,255),rgb(214,204,169,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(229,220,187,255),rgb(211,201,166,255),rgb(216,206,171,255),rgb(218,207,175,255),rgb(222,211,179,255),rgb(226,217,184,255),rgb(216,206,171,255),rgb(215,205,170,255),rgb(211,200,168,255),rgb(200,189,157,255),rgb(213,204,171,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(218,207,175,255),rgb(213,202,170,255)],
// [rgb(213,202,170,255),rgb(212,201,169,255),rgb(217,206,174,255),rgb(218,207,175,255),rgb(211,200,168,255),rgb(225,214,182,255),rgb(213,202,170,255),rgb(224,213,181,255),rgb(216,205,173,255),rgb(214,203,171,255),rgb(213,202,169,255),rgb(211,200,167,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(219,208,176,255),rgb(211,201,166,255),rgb(214,204,169,255),rgb(217,206,174,255),rgb(214,203,171,255),rgb(212,201,169,255),rgb(211,201,166,255),rgb(216,206,171,255),rgb(218,207,175,255),rgb(222,211,179,255),rgb(216,205,173,255)],
// [rgb(211,202,169,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(214,203,171,255),rgb(218,207,175,255),rgb(220,210,177,255),rgb(219,208,176,255),rgb(217,206,174,255),rgb(210,199,167,255),rgb(220,209,177,255),rgb(212,201,169,255),rgb(217,206,174,255),rgb(218,207,175,255),rgb(211,200,168,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(224,213,181,255),rgb(216,205,173,255),rgb(214,203,171,255),rgb(204,193,161,255),rgb(211,200,167,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(219,208,176,255),rgb(202,191,159,255)],
// [rgb(220,211,178,255),rgb(212,201,169,255),rgb(208,197,165,255),rgb(214,203,171,255),rgb(223,212,180,255),rgb(211,202,169,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(214,203,171,255),rgb(218,207,175,255),rgb(220,210,177,255),rgb(219,208,176,255),rgb(217,206,174,255),rgb(210,199,167,255),rgb(220,209,177,255),rgb(212,201,169,255),rgb(217,206,174,255),rgb(218,207,175,255),rgb(211,200,168,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(224,213,181,255),rgb(216,205,173,255),rgb(214,203,171,255),rgb(204,193,161,255)],
// [rgb(212,201,169,255),rgb(213,202,170,255),rgb(210,199,167,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(221,210,178,255),rgb(214,203,171,255),rgb(216,205,173,255),rgb(209,198,166,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(208,197,165,255),rgb(214,203,171,255),rgb(223,212,180,255),rgb(187,176,144,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(214,203,171,255),rgb(218,207,175,255),rgb(205,194,162,255),rgb(219,208,176,255),rgb(217,206,174,255),rgb(210,199,167,255),rgb(220,209,177,255),rgb(215,204,172,255)],
// [rgb(221,210,178,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(219,208,176,255),rgb(205,194,162,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(210,199,167,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(221,210,178,255),rgb(214,203,171,255),rgb(216,205,173,255),rgb(209,198,166,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(208,197,165,255),rgb(214,203,171,255),rgb(223,212,180,255),rgb(187,176,144,255),rgb(217,206,174,255),rgb(215,204,172,255),rgb(214,203,171,255),rgb(218,207,175,255),rgb(205,194,162,255)],
// [rgb(217,206,174,255),rgb(213,202,170,255),rgb(215,204,172,255),rgb(201,190,158,255),rgb(207,196,164,255),rgb(223,212,180,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(200,189,157,255),rgb(210,199,167,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(219,208,176,255),rgb(205,194,162,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(210,199,167,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(211,200,168,255),rgb(214,203,171,255),rgb(216,205,173,255),rgb(209,198,166,255),rgb(215,204,172,255),rgb(213,202,170,255)],
// [rgb(226,215,183,255),rgb(220,209,177,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(207,196,164,255),rgb(217,206,174,255),rgb(213,202,170,255),rgb(215,204,172,255),rgb(201,190,158,255),rgb(207,196,164,255),rgb(223,212,180,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(200,189,157,255),rgb(210,199,167,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(219,208,176,255),rgb(205,194,162,255),rgb(221,210,178,255),rgb(213,202,170,255),rgb(210,199,167,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(211,200,168,255)],
// [rgb(216,205,174,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(204,193,161,255),rgb(219,208,176,255),rgb(205,194,162,255),rgb(220,209,177,255),rgb(222,211,179,255),rgb(211,200,168,255),rgb(220,209,177,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(207,196,164,255),rgb(216,205,173,255),rgb(213,202,170,255),rgb(215,204,172,255),rgb(201,190,158,255),rgb(207,196,164,255),rgb(210,199,167,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(200,189,157,255),rgb(210,199,167,255),rgb(203,192,160,255)],
// [rgb(215,204,172,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(216,205,173,255),rgb(221,210,178,255),rgb(217,206,174,255),rgb(216,205,173,255),rgb(221,210,178,255),rgb(209,198,166,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(204,193,161,255),rgb(215,204,172,255),rgb(205,194,162,255),rgb(220,209,177,255),rgb(222,211,179,255),rgb(211,200,168,255),rgb(207,194,161,255),rgb(216,205,173,255),rgb(219,208,176,255),rgb(207,196,164,255),rgb(216,205,173,255),rgb(207,194,161,255)],
// [rgb(211,200,168,255),rgb(206,195,163,255),rgb(218,207,175,255),rgb(202,191,159,255),rgb(207,196,164,255),rgb(215,204,172,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(216,205,173,255),rgb(221,210,178,255),rgb(217,206,174,255),rgb(216,205,173,255),rgb(221,210,178,255),rgb(209,198,166,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(211,200,168,255),rgb(204,193,161,255),rgb(215,204,172,255),rgb(205,194,162,255),rgb(220,209,177,255),rgb(222,211,179,255),rgb(211,200,168,255),rgb(207,194,161,255)],
// [rgb(220,209,177,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(209,198,166,255),rgb(206,195,163,255),rgb(217,206,174,255),rgb(225,214,182,255),rgb(217,206,174,255),rgb(221,210,178,255),rgb(206,195,163,255),rgb(206,195,163,255),rgb(218,207,175,255),rgb(202,191,159,255),rgb(207,196,164,255),rgb(213,202,170,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(216,205,173,255),rgb(205,194,162,255),rgb(217,206,174,255),rgb(216,205,173,255),rgb(221,210,178,255),rgb(209,198,166,255),rgb(209,198,166,255)],
// [rgb(221,210,178,255),rgb(203,192,160,255),rgb(210,199,167,255),rgb(214,203,171,255),rgb(208,197,165,255),rgb(220,209,177,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(209,198,166,255),rgb(206,195,163,255),rgb(217,206,174,255),rgb(225,214,182,255),rgb(217,206,174,255),rgb(221,210,178,255),rgb(206,195,163,255),rgb(206,195,163,255),rgb(218,207,175,255),rgb(202,191,159,255),rgb(207,196,164,255),rgb(213,202,170,255),rgb(215,204,172,255),rgb(212,201,169,255),rgb(213,202,170,255),rgb(216,205,173,255),rgb(205,194,162,255)],
// [rgb(221,210,178,255),rgb(211,200,168,255),rgb(209,198,166,255),rgb(213,202,170,255),rgb(203,192,160,255),rgb(211,200,168,255),rgb(212,201,169,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(204,193,161,255),rgb(203,192,160,255),rgb(210,199,167,255),rgb(214,203,171,255),rgb(208,197,165,255),rgb(209,198,166,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(209,198,166,255),rgb(206,195,163,255),rgb(215,204,172,255),rgb(225,214,182,255),rgb(217,206,174,255),rgb(221,210,178,255),rgb(206,195,163,255),rgb(208,197,165,255)],
// [rgb(216,205,173,255),rgb(215,204,172,255),rgb(215,204,172,255),rgb(218,207,175,255),rgb(210,199,167,255),rgb(221,210,178,255),rgb(211,200,168,255),rgb(209,198,166,255),rgb(213,202,170,255),rgb(203,192,160,255),rgb(211,200,168,255),rgb(212,201,169,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(204,193,161,255),rgb(203,192,160,255),rgb(210,199,167,255),rgb(214,203,171,255),rgb(208,197,165,255),rgb(209,198,166,255),rgb(211,200,168,255),rgb(217,206,174,255),rgb(209,198,166,255),rgb(206,195,163,255),rgb(215,204,172,255)],
// [rgb(222,211,179,255),rgb(219,208,176,255),rgb(207,196,164,255),rgb(218,207,175,255),rgb(213,202,170,255),rgb(217,206,174,255),rgb(204,193,161,255),rgb(210,199,167,255),rgb(218,207,175,255),rgb(208,197,165,255),rgb(215,204,172,255),rgb(215,204,172,255),rgb(218,207,175,255),rgb(210,199,167,255),rgb(213,202,170,255),rgb(211,200,168,255),rgb(209,198,166,255),rgb(213,202,170,255),rgb(203,192,160,255),rgb(200,189,157,255),rgb(212,201,169,255),rgb(223,212,180,255),rgb(212,201,169,255),rgb(204,193,161,255),rgb(210,199,167,255)],


//         ];

        this.options = Object.assign(this.options, options);
        this.initColours();
        this.initSand();

    }
    initColours()
    {
        this.sandColoursHSL = [];
        console.log("Start init sand colours");
        for (let j = 0; j < this.baseSandColours.length; j++)
        {
            let initPixRGB = this.baseSandColours[j];
            let hslColr = this.rgbToHsl(initPixRGB);
            // console.log(initPixRGB)
            // let levelFactor = (this.state.maxSandLevel - i) / this.state.maxSandLevel;
            // levelFactor = (levelFactor * .7 + 0.2);
            // hslColr[2] = hslColr[2] * levelFactor;
            // let pixColr = this.hslToRgba(hslColr);
            this.sandColoursHSL.push(hslColr);
        }

        // for (let i = 0; i < this.state.maxSandLevel; i++)
        // {
        //     this.sandColours[i] = [];
        //     for (let j = 0; j < this.baseSandColours.length; j++)
        //     {
        //         let initPixRGB = this.baseSandColours[j];
        //         let hslColr = this.rgbToHsl(initPixRGB);
        //         console.log(initPixRGB)
        //         let levelFactor = (this.state.maxSandLevel - i) / this.state.maxSandLevel;
        //         levelFactor = (levelFactor * .7 + 0.2);
        //         hslColr[2] = hslColr[2] * levelFactor;
        //         let pixColr = this.hslToRgba(hslColr);
        //         this.sandColours[i].push(pixColr);
        //     }
        // }
        // console.log("End init sand colours");
    }


    randInt(min, max) {
        return Math.floor(Math.random() * (max - min) ) + min;
    }

    // colourIndex(sandLevel) {
    //     if (sandLevel === undefined)
    //         return [0,0,0,0];
    //     let colourIdx = Math.floor(sandLevel * this.sandToPixelScaleFactor);
    //     if (colourIdx < 0)
    //         colourIdx = 0;
    //     if (colourIdx > this.sandColours.length-1)
    //         colourIdx = this.sandColours.length-1;
    //     return this.sandColours.length-1-colourIdx;
    // }

    calcSandLightness(sandPtX, sandPtY, dimTowardsCentre, dimOnSurrounds)
    {
        // Sand level at this point
        let ptSandLevel = this.sandLevel[sandPtX][sandPtY];

        // Go round shading rings around point to see if shaded by higher points
        let sandLightness = 1.0;

        // // Go round shading rings around point to see if shaded by higher points
        if (dimOnSurrounds)
        {
            // for (let k = 0; k < this.shadingRings.length; k++)
            // {
            //     let shadingRing = this.shadingRings[k];
            //     let shadingInc = this.shadingRingFactors[k] / shadingRing.length;
            //     for (let l = 0; l < shadingRing.length; l++)
            //     {
            //         let testPtX = shadingRing[l][0] + sandPtX;
            //         let testPtY = shadingRing[l][1] + sandPtY;
            //         if ((testPtX < 0) || (testPtY < 0) || (testPtX >= this.state.sandTableSideLen) || (testPtY >= this.state.sandTableSideLen))
            //             continue;
            //         let shadePixLev = this.sandLevel[testPtX][testPtY];
            //         if (shadePixLev > ptSandLevel)
            //         {
            //             let insideFactor = (Math.pow(testPtX-this.state.sandTableSideLen/2,2)+Math.pow(testPtY-this.state.sandTableSideLen/2,2)) < (Math.pow(sandPtX-this.state.sandTableSideLen/2,2)+Math.pow(sandPtY-this.state.sandTableSideLen/2,2)) ? 0.5 : 1;
            //             // shadingFactor += 10 * (ptSandLevel - shadePixLev) / this.state.sandStartLevel / shadingRing.length; // + insideFactor;
            //             shadingFactor += shadingInc * insideFactor;
            //         }
            //         // else
            //         // {
            //         //     sandLevelShaded -= 10 * (ptSandLevel - shadePixLev) / this.state.sandStartLevel / shadingRing.length; // + insideFactor;                  
            //         // }
            //     }
            // }
            if (sandPtX + 1 < this.state.sandTableSideLen && sandPtY + 1 < this.state.sandTableSideLen && sandPtX > 0 && sandPtY > 0)
            {
                let cOffset = [sandPtX - this.state.sandTableSideLen/2, sandPtY - this.state.sandTableSideLen/2];
                let pixOff = [0, 0]
                if (cOffset[0] > 0)
                {
                    if (cOffset[1] > 0)
                        pixOff = [1, 1];
                    else
                        pixOff = [1, -1];
                }
                else
                {
                    if (cOffset[1] > 0)
                        pixOff = [-1, 1];
                    else
                        pixOff = [-1, -1];
                }
                // if (ptSandLevel[1] > this.state.sandTableSideLen/2)
                //     pixOff = [-1,0]
                let slope = (ptSandLevel - this.sandLevel[sandPtX+pixOff[0]][sandPtY+pixOff[1]]) / this.state.maxSandLevel;
                // let b = 1.0;
                
                // b = ptSandLevel - this.sandLevel[sandPtX+pixOff[0]][sandPtY+pixOff[1]];

                if (slope > 0)
                    sandLightness = sandLightness + slope*1.1;
                else
                    sandLightness = sandLightness + 
                            slope*2 * (ptSandLevel < this.state.sandStartLevel ? (this.state.maxSandLevel-ptSandLevel)/this.state.maxSandLevel : 1) ;
                // else
                //     b = b + slope * 3;
                // let b = slope + 0.5;
                // if (b < 0) b = 0;
                // if (b > 1) b = 0.999;
                // shadingFactor = 1 - b;
            }          
        }
        // else
        // {
        //     sandLightness = ptSandLevel / this.state.maxSandLevel;
        // }

        // Sand lightness
        // let sandLightness = 1 - shadingFactor * 1;

        // Dimming based on distance from centre
        if (dimTowardsCentre)
        {
            let dimFactor = .3;
            let dimOffset = .7;
            let lightDistFactor = (dimFactor * Math.sqrt(Math.pow(sandPtX-this.state.sandTableSideLen/2,2)+Math.pow(sandPtY-this.state.sandTableSideLen/2,2)) / (this.state.sandTableSideLen/2)) + dimOffset;
            sandLightness *= lightDistFactor;
        }

        // Check bounds
        if (sandLightness >= 1.2)
            sandLightness = 1.19;
        if (sandLightness < 0.4)
            sandLightness = 0.4;
        return sandLightness;
    }

    pixelLookup(sandPtX, sandPtY) {

        let hslColr = this.sandColoursHSL[this.randInt(0,this.sandColoursHSL.length)].slice();
        hslColr[2] *= this.calcSandLightness(sandPtX, sandPtY, true, true);
        let pixColr = this.hslToRgba(hslColr)
        // let sandRangeIdx = this.sandColours.length - 1 - Math.floor(sandLightness * this.sandColours.length);
        // let sandRange = this.sandColours[sandRangeIdx];
        return pixColr;
    }

    recreateSandSquareImage(changePos, changeSize) {
        let canvas = document.getElementById('table-canvas');
        let ctx = canvas.getContext('2d');
        let chgOffsetX = 0
        let chgTLX = Math.floor(changePos[0]-changeSize/2);
        if (chgTLX < 0)
        {
            chgOffsetX = -chgTLX;
            chgTLX = 0;
        }
        let chgOffsetY = 0;
        let chgTLY = Math.floor(changePos[1]-changeSize/2);
        if (chgTLY < 0)
        {
            chgOffsetY = -chgTLY;
            chgTLY = 0;
        }
        let chgSq = ctx.getImageData(chgTLX, chgTLY,
                        changeSize-chgOffsetX,
                        changeSize-chgOffsetY);
        let k = 0;
        let changeSizeSqd = Math.pow(changeSize,2);
        for (let i = 0; i < chgSq.height; i++)
        {
            let sandPtY = i + chgTLY;
            if (sandPtY >= this.state.sandTableSideLen)
                break;
            for (let j = 0; j < chgSq.width; j++)
            {
                let sandPtX = j + chgTLX;
                if (sandPtX >= this.state.sandTableSideLen)
                    break;

                // Check if this pixel is within the circular area of changeSize
                if ((Math.pow(sandPtX-changePos[0]) + Math.pow(sandPtY-changePos[1],2)) > changeSizeSqd)
                    continue;

                // Sand level at this point
                let ptSandLevel = this.sandLevel[sandPtX][sandPtY];

                // Go round shading rings around point to see if shaded by higher points
                let sandLevelShaded = 0;
                sandLevelShaded = ptSandLevel;
                for (let k = 0; k < this.shadingRings.length; k++)
                {
                    let shadingRing = this.shadingRings[k];
                    for (let l = 0; l < shadingRing.length; l++)
                    {
                        let testPtX = shadingRing[l][0] + j + chgTLX;
                        let testPtY = shadingRing[l][1] + i + chgTLY;
                        if ((testPtX < 0) || (testPtY < 0) || (testPtX >= this.state.sandTableSideLen) || (testPtY >= this.state.sandTableSideLen))
                            continue;
                        let shadePixLev = this.sandLevel[testPtX][testPtY];
                        let insideFactor = (Math.pow(testPtX-this.state.sandTableSideLen/2,2)+Math.pow(testPtY-this.state.sandTableSideLen/2,2)) < (Math.pow(sandPtX-this.state.sandTableSideLen/2,2)+Math.pow(sandPtY-this.state.sandTableSideLen/2,2)) ? 1 : -1;
                        if (shadePixLev > ptSandLevel)
                            sandLevelShaded += (ptSandLevel - shadePixLev) / this.state.sandStartLevel / shadingRing.length + insideFactor;
                    }
                }
                // // See if shaded by sand in rings around this point
                // let shadingFactor = 0;
                // for (let k = 0; k < this.state.numShadingRings; k++) {
                //     let kernelRing = this.fullCircleKernelLists[k];
                //     for (let s = 0; s < kernelRing.length; s++) {
                //         // Check if this sand pixel shades
                //         let testPtX = kernelRing[s][0] + j + chgTLX;
                //         let testPtY = kernelRing[s][1] + i + chgTLY;
                //         if ((testPtX >= this.state.sandTableSideLen) || (testPtY >= this.state.sandTableSideLen))
                //             continue;
                //         let sandLev = this.sandLevel[testPtX][testPtY];
                //         if (sandLev > ptSandLevel)
                //         {
                //             shadingFactor +=  (sandLev - ptSandLevel) / this.state.sandStartLevel / (k+2) / kernelRing.length / (k+1);
                //         }
                //     }
                // }
                // if (sandLevelShaded < 0)
                //     sandLevelShaded = 0;
                // if (sandLevelShaded >= this.state.maxSandLevel)
                //     sandLevelShaded = this.state.maxSandLevel-0.01;
                // shadingFactor = 1 - shadingFactor;
                // let shadingFactor = this.sandLevel[j+chgTLX][i+chgTLY]/this.state.maxSandLevel;

                // Work outwards to see if 

                // fullSqData[k] = this.sandLevel[j][i];
                // fullSqData[k+1] = this.sandLevel[j][i];
                // fullSqData[k+2] = this.sandLevel[j][i];
                let pixVal = this.pixelLookup(sandPtX, sandPtY);
                chgSq.data[k] = pixVal[0];
                chgSq.data[k+1] = pixVal[1];
                chgSq.data[k+2] = pixVal[2];
                chgSq.data[k+3] = pixVal[3];
                // if (fullSqData[k]>200 && fullSqData[k+1]>200 && fullSqData[k+2]>200)
                //     debugger;
                k+=4;
            }
        }
        ctx.putImageData(chgSq,chgTLX,chgTLY);
    }

    initSand()
    {
        this.createSand();
        this.createKernel();
        this.showSand();
    }
    createSand() {
        let sandTableSideLen = this.state.sandTableSideLen;
        // Generate a 2D array of distances from the centre of the kernel
        this.sandLevel = new Array(sandTableSideLen);
        for (let i = 0; i < sandTableSideLen; i++)
        {
            this.sandLevel[i] = new Array(sandTableSideLen);
            for (let j = 0; j < sandTableSideLen; j++)
            {
                this.sandLevel[i][j] = this.state.sandStartLevel;
                // console.log(i + "," + j + "," + this.kernel[i][j]);
            }
        }
    }

    createKernel() {
        let kernelSize = this.state.kernelSize;
        let kernelDistSize = kernelSize*2;
        // Generate a 2D (square) array of distances from the centre of the square
        let bs = this.state.ballDiameter;
        this.kernelRingDistances = [bs/20,bs/10,bs/4,bs/3,bs/2,bs*0.75]
        this.kernelDistSquare = new Array(kernelDistSize);
        for (let i = 0; i < kernelDistSize; i++)
        {
            this.kernelDistSquare[i] = new Array(kernelDistSize);
            for (let j = 0; j < kernelDistSize; j++)
            {
                let distFromCtr = Math.round(Math.sqrt((Math.pow(i - kernelDistSize/2, 2)) + (Math.pow(j - kernelDistSize/2, 2))));
                let ringIdx = 0;
                for (let k = 0; k < this.kernelRingDistances.length; k++) {
                    if (distFromCtr <= this.kernelRingDistances[k])
                        break;
                    ringIdx++;
                }
                this.kernelDistSquare[i][j] = ringIdx;
                // console.log(i + "," + j + "," + this.kernel[i][j]);
            }
        }
        // Create a series of rings (lists of pixels at approx equal distances from kernel centre)
        this.numKernelRings = this.kernelRingDistances.length;
        this.fullCircleKernelLists = new Array();
        for (let k = 0; k < this.numKernelRings; k++)
            this.fullCircleKernelLists[k] = [];
        let offsetDistCoordsToKernelCoords = (kernelDistSize-kernelSize)/2;
        for (let i = 0; i < kernelDistSize; i++)
        {
            for (let j = 0; j < kernelDistSize; j++)
            {
                let kernelRingIdx = this.kernelDistSquare[i][j];
                if (kernelRingIdx < this.numKernelRings)
                    this.fullCircleKernelLists[kernelRingIdx].push([i-offsetDistCoordsToKernelCoords,j-offsetDistCoordsToKernelCoords]);
            }
        }
        for (let k = 0; k < this.numKernelRings; k++)
            console.log("Ks " + this.fullCircleKernelLists[k].length);
        // Sand amount to move at each ring of distance - this is like a threshold level (curvature of ball bearing)
        this.kernelMoveThreshold = new Array(this.numKernelRings);
        for (let k = 0; k < this.numKernelRings; k++) {
            // this.kernelMoveThreshold[k] = (this.state.ballDiameter/2) * Math.sin(k * Math.PI / kernelSize);
            // let thirdSide = Math.sqrt(Math.pow(this.state.ballDiameter/2,2) - Math.pow(this.kernelRingDistances[k],2))
            // let pressBeyondBall = this.state.maxSandLevel;
            // this.kernelMoveThreshold[k] = (this.kernelRingDistances[k] < this.state.ballDiameter/2) ? this.state.ballDiameter/2 - thirdSide : pressBeyondBall;
            this.kernelMoveThreshold[k] = 3*k;
            console.log("moveThreshold " + this.kernelRingDistances[k] + " = " + this.kernelMoveThreshold[k]);
        }
        // For each of a number of angle ranges, calculate lists of "sand pixels" are within that angle range
        this.kernelAngleRanges = 32;
        this.kernelSrcDests = new Array(this.kernelAngleRanges);
        let kSize = this.state.kernelSize;
        for (let i = 0; i < this.kernelSrcDests.length; i++) {
            // Angle
            let directionAngle = i * 2 * Math.PI / this.kernelAngleRanges;
            // Create array of source/dest info
            this.kernelSrcDests[i] = Array(this.numKernelRings-1);
            // Iterate base list and find which source rings are at the appropriate angle
            for (let k = 0; k < this.numKernelRings-1; k++) {
                this.kernelSrcDests[i][k] = []
                // Iterate the list of potential source sand pixels at this ring
                let kernelRing = this.fullCircleKernelLists[k];
                for (let s = 0; s < kernelRing.length; s++) {
                    // Check if this sand pixel is within the angle range for source
                    let sandPixPtOffset = kernelRing[s];
                    let angleOfSourceSandPixel = this.getAngleFromPoint(sandPixPtOffset, [kSize/2,kSize/2]);
                    // console.log("Sourceang " + angleOfSandPixel + " moveAngle " + directionAngle);
                    if (this.compareAngleOffset(angleOfSourceSandPixel, directionAngle, -Math.PI / 2, Math.PI / 2)) {
                        // Get the list of destination sand pixels for this sand pixel
                        let destRing = this.fullCircleKernelLists[k + 1];
                        let destPtList = [];
                        for (let t = 0; t < destRing.length; t++) {
                            // Get the angle to this sand pixel
                            let destKernelPt = destRing[t];
                            let angleOfDestSandPixel = this.getAngleFromPoint(destKernelPt, sandPixPtOffset);
                            // let log2RingLen = Math.log2(destRing.length);
                            // if (i == 16 && k == 4 && s == 4)
                            //     console.log("src " + sandPixPtOffset + " dest " + destKernelPt + " dang " + angleOfDestSandPixel + 
                            //         " srcAng " + angleOfSourceSandPixel + " dirnAng " + directionAngle + " low " + (-Math.PI / log2RingLen) + " hi " + Math.PI / log2RingLen +
                            //         " val " + (angleOfDestSandPixel - angleOfSourceSandPixel - (2 * Math.PI)) + " lpg2 " + log2RingLen);
                            if (this.compareAngleOffset(angleOfDestSandPixel, angleOfSourceSandPixel, -Math.PI / 4, Math.PI / 4)) {
                                destPtList.push(destKernelPt);
                            }
                        }
                        // Add source point and dest list
                        if (destPtList.length > 0)
                            this.kernelSrcDests[i][k].push({ srcPt: sandPixPtOffset, destPts: destPtList});
                    }
                }
            }
        }
        // console.log("Angle 16 ring 4 " + this.kernelSrcDests[16][4][4].srcPt + ", " + this.kernelSrcDests[16][4][4].destPts);
        // Create shading rings
        this.shadingRings = [
            [[-1,-1],[1,-1],[1,1],[-1,1]],
            [[-3,0],[-2,2],[0,3],[2,2],[3,0],[2,-2],[0,-3],[-2,-2]],
            [[-5,-6],[-7,-2],[-7,2],[-5,6],[-2,7],[2,7],[5,6],[7,2],[7,-2],[5,-6],[2,-7],[-2,-7]]
            ];
        // The elements of the following must add up to 1 
        this.shadingRingFactors = [0.4, 0.3, 0.3]

        // for (let i = 0; i < this.kernelSrcDests.length; i++)
        // {
        //     let srcDest = this.kernelSrcDests[i]
        //     for (let j = 0; j < srcDest.length; j++)
        //     {
        //         let ring = srcDest[j]
        //         console.log("Direction " + i + " ring " + j)
        //         for (let k = 0; k < ring.length; k++)
        //         {

        //             console.log(ring[k].srcPt + "->" + ring[k].destPts)
        //         }
        //     }
        // }
    }


    getAngleFromPoint(toPt, fromPt) {
        let diffAngle = Math.atan2(fromPt[1] - toPt[1], toPt[0] - fromPt[0]);
        return diffAngle;
    }

    compareAngleOffset(ang, offset, lowRange, highRange)
    {
        let diffAngle = ang - offset;
        // Correct wrapping around circle
        if (diffAngle < -Math.PI)
            diffAngle += 2 * Math.PI;
        if (diffAngle > Math.PI)
            diffAngle -= 2 * Math.PI;
        return (diffAngle > lowRange && diffAngle < highRange);
    }

    dumpSand() {
        console.log("Sand!");
        let sandTableSideLen = this.state.sandTableSideLen;
        for (let i = 0; i < sandTableSideLen; i++)
        {
            let sss = "";
            for (let j = 0; j < sandTableSideLen; j++)
            {
                sss += ((j === 0) ? "" : ",") + this.sandLevel[i][j];
                // console.log(i + "," + j + "," + this.kernel[i][j]);
            }
            console.log(sss);
        }

    }

    moveSand(ballX, ballY, moveAngleACWFromEast) {
        ballX = Math.floor(ballX)
        ballY = Math.floor(ballY)
        // Work out from the centre of the ball bearing moving "sand"
        let kSize = this.state.kernelSize;
        let sandAccumulator = 0;
        // Calculate which direction range the ball is moving in
        let directionRange = Math.floor(this.kernelAngleRanges * ((moveAngleACWFromEast + 2 * Math.PI) % (2 * Math.PI)) / (2 * Math.PI));
        if (directionRange < 0)
            directionRange = 0;
        if (directionRange >= this.kernelAngleRanges)
            directionRange = this.kernelAngleRanges-1;
        // Get the list of sand pixel rings for this angle
        let sourceDests = this.kernelSrcDests[directionRange];
        // console.log("dirnRange " + directionRange)
        // Iterate the ring
        for (let k = 0; k < sourceDests.length; k++) {
            // Iterate the source sand pixels within the ring
            for (let j = 0; j < sourceDests[k].length; j++) {
                let sourcePtOffset = sourceDests[k][j].srcPt;
                let sourceSandPt = [Math.floor(sourcePtOffset[0] + ballX - this.state.kernelSize / 2), Math.floor(sourcePtOffset[1] + ballY - this.state.kernelSize / 2)];
                if (sourceSandPt[0] < 0 || sourceSandPt[0] >= this.state.sandTableSideLen)
                    continue;
                if (sourceSandPt[1] < 0 || sourceSandPt[1] >= this.state.sandTableSideLen)
                    continue;
                // Move all the sand above the threshold
                let sandToMove = this.sandLevel[sourceSandPt[0]][sourceSandPt[1]] - this.kernelMoveThreshold[k];
                if (sandToMove < 0)
                    sandToMove = 0;
                // console.log("SandQty at " + sourceSandPt[0] + ", g" + sourceSandPt[1] + " ring " + k + " = " + this.sandLevel[sourceSandPt[0]][sourceSandPt[1]] + " => " + this.kernelMoveThreshold[k]);
                // (" + this.kernelMoveThreshold[k] + ") = " + sandToMove + " total " + this.sandLevel[sourceSandPt[0]][sourceSandPt[1]]);
                this.sandLevel[sourceSandPt[0]][sourceSandPt[1]] -= sandToMove;


                if (this.totalSandLoss > 0)
                {
                    let lostSandToDistribute = this.totalSandLoss / 100;
                    sandToMove += lostSandToDistribute;
                    this.totalSandLoss -= lostSandToDistribute;
                }

                // this.sandLevel[sourceSandPt[0]][sourceSandPt[1]] = 0;

                // if (isNaN(this.sandLevel[sourceSandPt[0]][sourceSandPt[1]]))
                //     debugger
                // Add sand acculumated from spill-over
                // console.log("SandToMove = " + sandToMove + ", sandAccumulator = " + sandAccumulator);
                // sandToMove += sandAccumulator;
                // sandAccumulator = 0;
                // Distribute to dest points
                let destPtList = sourceDests[k][j].destPts;
                if (destPtList.length == 0)
                    debugger;
                for (let i = 0; i < destPtList.length; i++) {
                    let destPtOffset = destPtList[i];
                    let destPt = [Math.floor(destPtOffset[0] + ballX - this.state.kernelSize / 2), Math.floor(destPtOffset[1] + ballY - this.state.kernelSize / 2)];
                    if (destPt[0] < 0 || destPt[0] >= this.state.sandTableSideLen)
                        continue;
                    if (destPt[1] < 0 || destPt[1] >= this.state.sandTableSideLen)
                        continue;


                    this.sandLevel[destPt[0]][destPt[1]] += sandToMove / destPtList.length;

                    // this.sandLevel[destPt[0]][destPt[1]] = 19.9;


                    if (isNaN(this.sandLevel[destPt[0]][destPt[1]]))
                        debugger
                    // If the sand level is above max then distribute to the next ring outwards using the sandAccumulator
                    if (this.sandLevel[destPt[0]][destPt[1]] >= this.state.maxSandLevel) {
                        sandAccumulator += this.sandLevel[destPt[0]][destPt[1]] - this.state.maxSandLevel + 0.01;
                        this.sandLevel[destPt[0]][destPt[1]] = this.state.maxSandLevel - 0.01;
                    }
                    // console.log("Dest at " + destPtList[i][0] + "," + destPtList[i][1] + " = " + this.sandLevel[destPtList[i][0]][destPtList[i][1]]);
                }
            }
        }

        // console.log("Final sandAccumulator " + sandAccumulator);

        // sandAccumulator += sandToMove;
        // Spread the left-over sand
        // if (sandAccumulator > 0) {
        //     let tlx = Math.floor(ballX - this.state.kernelSize / 2);
        //     if (tlx < 0)
        //         tlx = 0;
        //     let tly = Math.floor(ballY - this.state.kernelSize / 2);
        //     if (tly < 0)
        //         tly = 0;
        //     let spreadX = Math.floor(tlx + this.state.kernelSize);
        //     if (spreadX >= this.state.sandTableSideLen)
        //         spreadX = this.state.sandTableSideLen - 1;
        //     let spreadY = Math.floor(tly + this.state.kernelSize);
        //     if (spreadY >= this.state.sandTableSideLen)
        //         spreadY = this.state.sandTableSideLen - 1;
        //     let sandToAdd = sandAccumulator / ((spreadX-tlx)*(spreadY-tly));
        //     for (let ix = tlx; ix < spreadX; ix++)
        //         for (let iy = tly; iy < spreadY; iy++)
        //         {
        //             this.sandLevel[ix][iy] += sandToAdd;
        //             sandAccumulator -= sandToAdd;
        //         }
        // }

        this.totalSandLoss += sandAccumulator;

        // // Redraw the image around the ball position
        // this.recreateSandSquareImage([ballX,ballY], this.state.kernelSize);

        // this.tallySand();
    }

    tallySand() {
        let sandTot = 0;
        // let histBars = [];
        let sandBars = [];
        let maxLev = this.sandLevel[0][0];
        // for (let i = 0; i < this.sandColours.length; i++) {
        //     histBars.push(0);
        // }
        for (let i = 0; i < this.state.maxSandLevel; i++) {
            sandBars.push(0);
        }
        let sandTableSideLen = this.state.sandTableSideLen;
        for (let i = 0; i < sandTableSideLen; i++) {
            for (let j = 0; j < sandTableSideLen; j++) {
                // Debug
                if (maxLev < this.sandLevel[j][i])
                    maxLev = this.sandLevel[j][i];
                // histBars[this.colourIndex(this.sandLevel[j][i])]++;
                sandBars[Math.floor(this.sandLevel[j][i])]++;
                sandTot += this.sandLevel[j][i];
            }
        }
        console.log("TotalSand " + sandTot + ", MaxLev " + maxLev + ", average " + sandTot / sandTableSideLen / sandTableSideLen + " TotalSandLoss " + this.totalSandLoss);

        // let barSum = 0;
        // for (let i = 0; i < histBars.length; i++) {
        //     console.log(i + " colr " + histBars[i]);
        //     barSum += histBars[i];
        // }
        // console.log("ColrSum = " + barSum);

        // let sandSum = 0;
        // for (let i = 0; i < sandBars.length; i++) {
        //     console.log(i + " sand " + sandBars[i]);
        //     sandSum += sandBars[i];
        // }
        // console.log("SandSum = " + barSum);

    }
    showSand() {
        let canvas = document.getElementById('table-canvas');
        let ctx = canvas.getContext('2d');
        let fullSq = ctx.getImageData(0, 0, 
                        this.state.sandTableSideLen,
                        this.state.sandTableSideLen);
        let sandTableSideLen = this.state.sandTableSideLen;
        let fullSqData = fullSq.data;
        let k = 0;
        for (let i = 0; i < sandTableSideLen; i++)
        {
            for (let j = 0; j < sandTableSideLen; j++)
            {
                // fullSqData[k] = this.sandLevel[j][i];
                // fullSqData[k+1] = this.sandLevel[j][i];
                // fullSqData[k+2] = this.sandLevel[j][i];
                let pixVal = this.pixelLookup(j, i);  // this.sandLevel[j][i]);
                fullSqData[k] = pixVal[0];
                fullSqData[k+1] = pixVal[1];
                fullSqData[k+2] = pixVal[2];
                fullSqData[k+3] = pixVal[3];
                // if (fullSqData[k]>200 && fullSqData[k+1]>200 && fullSqData[k+2]>200)
                //     debugger;
                k+=4;
            }
        }
        ctx.putImageData(fullSq,0,0);
    }
    getCanvasXYPos(canvas, varContext)
    {
        let wid = canvas.clientWidth - this.state.canvasBorder * 2;
        let hig = canvas.clientHeight - this.state.canvasBorder * 2;
        let xPos = ((varContext.x + varContext.originX)  / varContext.sizeX) * wid + this.state.canvasBorder;
        let yPos = canvas.clientHeight - (((varContext.y + varContext.originY)  / varContext.sizeY) * hig + this.state.canvasBorder);
        return [ xPos, yPos];
    }
    sqDistFrom(pt1, pt2)
    {
        return Math.pow(pt2[0]-pt1[0],2)+Math.pow(pt2[1]-pt1[1],2);
    }
    simStart(varContext)
    {
        let canvas = document.getElementById('table-canvas');
        const pointXY = this.getCanvasXYPos(canvas, varContext);
        this.state.ballPos[0] = pointXY[0];
        this.state.ballPos[1] = pointXY[1];
        // Start by moving sand all around the ball (in both forward and reverse direction)
        this.moveSand(pointXY[0], pointXY[1], 0);
        this.moveSand(pointXY[0]+1, pointXY[1], Math.PI);  
        // Redraw the image around the ball position
        this.recreateSandSquareImage(this.state.ballPos, this.state.kernelSize);
        // debugDump(300,300);
        this.state.lastRedrawPos = this.state.ballPos.slice();
    }
    simNexPoint(varContext)
    {
        let canvas = document.getElementById('table-canvas');
        const pointXY = this.getCanvasXYPos(canvas, varContext);
        let pixelDist = Math.sqrt(Math.pow(pointXY[0]-this.state.ballPos[0], 2) + Math.pow(pointXY[1]-this.state.ballPos[1], 2));
        let drawSteps = Math.ceil(pixelDist+0.00001);
        if (drawSteps >= 500)
            drawSteps = 500;
        let stepX = (pointXY[0]-this.state.ballPos[0])/drawSteps;
        let stepY = (pointXY[1]-this.state.ballPos[1])/drawSteps;
        let ballAngle = Math.atan2(-stepY, stepX);
        for (let i = 0; i < drawSteps; i++)
        {
            let x = this.state.ballPos[0] + stepX * i;
            let y = this.state.ballPos[1] + stepY * i;
            this.moveSand(x, y, ballAngle, false);
            if (this.sqDistFrom([x,y], this.state.lastRedrawPos) > 10)
            {
                // Redraw the image around the ball position
                this.recreateSandSquareImage([x,y], this.state.kernelSize);
                this.state.lastRedrawPos = [x,y];
            }
        }
        this.state.ballPos[0] = pointXY[0];
        this.state.ballPos[1] = pointXY[1];
    }
    // debugIt()
    // {
    //     for (let i = 620; i < 680; i++)
    //     {
    //         console.log (this.sandLevel[i][400]);
    //     }
    // }
    // moveStep() {
    //  let canvas = document.getElementById('table-canvas');
    //     let canvasOff = canvas.getBoundingClientRect();

    //     // let ballX = this.state.sandTableSideLen/2 + (this.state.sandTableSideLen / 2 - 20 - this.evalExpr.r) * Math.sin(this.evalExpr.t);
    //     // let ballY = this.state.sandTableSideLen/2 + (this.state.sandTableSideLen / 2 - 20 - this.evalExpr.r) * Math.cos(this.evalExpr.t);
    //     // this.evalExpr.t += 0.01;
    //     // this.evalExpr.r += 0.01;
    //     // if (this.evalExpr.t > 600)
    //     //     this.evalExpr.t = 0;
    //     let t = this.evalExpr.t;

    //     let ballX = Math.sin(t/20) * (270 - t/10) * (1 + Math.sin(t*1.03)*0.05);
    //     let ballY = Math.cos(t/20) * (270 - t/10) * (1 + Math.sin(t*1.03)*0.05);
    //     this.evalExpr.t += 0.1;
    //     if (this.evalExpr.t > 100000)
    //         this.evalExpr.t = 0;
    //     ballX = this.state.sandTableSideLen/2 + ballX;
    //     ballY = this.state.sandTableSideLen/2 + ballY;

    //     let ballAngle = Math.atan2(this.state.ballPos[1] - ballY, ballX - this.state.ballPos[0]);
    //     this.state.ballPos[0] = ballX;
    //     this.state.ballPos[1] = ballY;
    //     this.moveSand(ballAngle);
    // }

    // animate() {
    //     for (let i = 0; i < 100; i++)
    //         this.moveStep();
    //     //this.showSand();
    //     requestAnimationFrame(() => this.animate());
    // }

    /**
    * http://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion
    * SOURCE: http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c
    * Converts an HSL color value to RGB. Conversion formula
    * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
    * Assumes h, s, and l are contained in the set [0, 1] and
    * returns r, g, and b in the set [0, 255].
    *
    * @param   Number  h       The hue
    * @param   Number  s       The saturation
    * @param   Number  l       The lightness
    * @return  Array           The RGB representation
    */
    hslToRgba(hsl){
        let r, g, b;
        let h = hsl[0], s = hsl[1], l = hsl[2];

        if (s == 0) {
            r = g = b = l; // achromatic
        } else {
          var hue2rgb = function hue2rgb(p, q, t){
            if(t < 0) t += 1;
            if(t > 1) t -= 1;
            if(t < 1/6) return p + (q - p) * 6 * t;
            if(t < 1/2) return q;
            if(t < 2/3) return p + (q - p) * (2/3 - t) * 6;
            return p;
          }

          var q = l < 0.5 ? l * (1 + s) : l + s - l * s;
          var p = 2 * l - q;
          r = hue2rgb(p, q, h + 1/3);
          g = hue2rgb(p, q, h);
          b = hue2rgb(p, q, h - 1/3);
        }

        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255), 255];
      }
      
    /**
    * http://stackoverflow.com/questions/2353211/hsl-to-rgb-color-conversion
    * SOURCE: http://axonflux.com/handy-rgb-to-hsl-and-rgb-to-hsv-color-model-c  
    * Converts an RGB color value to HSL. Conversion formula
    * adapted from http://en.wikipedia.org/wiki/HSL_color_space.
    * Assumes r, g, and b are contained in the set [0, 255] and
    * returns h, s, and l in the set [0, 1].
    *
    * @param   Number  r       The red color value
    * @param   Number  g       The green color value
    * @param   Number  b       The blue color value
    * @return  Array           The HSL representation
    */
    rgbToHsl(rgb){
        let r = rgb[0] / 255, g = rgb[1] / 255, b = rgb[2] / 255;
        var max = Math.max(r, g, b), min = Math.min(r, g, b);
        var h, s, l = (max + min) / 2;

        if (max == min) {
            h = s = 0; // achromatic
        } else {
          var d = max - min;
          s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
          switch(max){
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }

        return [h, s, l];
    }
  
}


    function toRGBArrayStr(arr) {
        let pixStr = "";
        for (var i = 0; i < arr.length; i++)
            pixStr += ((pixStr.length === 0) ? "" : ",") + this.toRGBStr(arr[i]);
        return "[" + pixStr + "]";
    }

    function toRGBStr(pixData) {
         return "rgb(" + pixData[0] + "," + pixData[1] + "," + pixData[2] + "," + pixData[3] + ")";
    }
    // mousemove(event) {
        
    //     let canvasOff = this.canvas.getBoundingClientRect();

    //     let imgX = Math.floor(event.clientX - canvasOff.left);
    //     let imgY = Math.floor(event.clientY - canvasOff.top);

    //     let mouseX = event.clientX;
    //     let mouseY = event.clientY;

    //     var fullSq = this.ctx.getImageData(0, 0, 
    //                     this.state.sandTableSideLen,
    //                     this.state.sandTableSideLen);

    //     var tooltip = document.querySelector('#tooltip');

    //     let pixIdx = imgX * 4 + this.state.sandTableSideLen * imgY * 4;
    //     tooltip.innerHTML = this.sandLevel[imgX][imgY].toFixed(2) + " (" + fullSq.data[pixIdx] + ", " + fullSq.data[pixIdx+1] + ", " + fullSq.data[pixIdx+2] + ")";
    //     tooltip.style.left = (mouseX-14) + "px";
    //     tooltip.style.top = (mouseY+12) + "px";
    // }

    // mouseover(event) {
    //     var canvas = document.querySelector('#tooltip');
    //     canvas.setAttribute("style","display:inline");
    // }

    // mouseout(event) {
    //     var canvas = document.querySelector('#tooltip');
    //     canvas.setAttribute("style","display:none");
    // }

    function getImagePixels(pixPos, sqSize) {
        var img = document.getElementById('sand');
        var memCanvas = document.createElement('canvas');
        memCanvas.width = img.width;
        memCanvas.height = img.height;
        memCanvas.getContext('2d').drawImage(img, 0, 0, img.width, img.height);
        var pixelData = memCanvas.getContext('2d').getImageData(pixPos[0]-Math.floor(sqSize/2), pixPos[1]-Math.floor(sqSize/2), sqSize, sqSize).data;
        console.log(pixPos[0] + ", " + pixPos[1] + " = ", pixelData);
        return pixelData;
    }

    // mouseclicksand(event) {

    //     var img = document.querySelector('#sand');
    //     let imgOff = img.getBoundingClientRect();

    //     let imgX = Math.floor(event.clientX - imgOff.left);
    //     let imgY = Math.floor(event.clientY - imgOff.top);

    //     console.log("ClickSand " + imgX + ", " + imgY);

    //     let pixData = this.getImagePixels([imgX, imgY], this.state.imgPixSqSize);
    //     let colrArry = [];
    //     for (var i = 0; i < this.state.imgPixSqSize * this.state.imgPixSqSize * 4; i+=4)
    //         colrArry.push([pixData[i], pixData[i+1], pixData[i+2], pixData[i+3]]);
    //     let pixDataStr = this.toRGBArrayStr(colrArry);
    //     let onePixStr = this.toRGBStr(colrArry[0]);
    //     // var fullSq = this.ctx.getImageData(0, 0,
    //     //                 this.state.sandTableSideLen,
    //     //                 this.state.sandTableSideLen);


    //     let elStr = $('.selected');
    //     let that = this;
    //     elStr.each(function() {
    //         $(this).val(pixDataStr);
    //         $(this).parent().parent().find(".colourPatchDiv").css('background-color', onePixStr);
    //         let cidx = parseInt($(this).parent().parent().find(".cidx").text());
    //         that.sandColours[cidx] = colrArry;
    //     });

    //     this.showSand();
    // }





    // animate() {
    //     for (let i = 0; i < 100; i++)
    //         this.moveStep();
    //     //this.showSand();
    //     requestAnimationFrame(() => this.animate());
    // }


// function handleMouseMove(event) {
//     var dot, eventDoc, doc, body, pageX, pageY;

//     event = event || window.event; // IE-ism

//     let x = event.pageX;
//     let y = event.pageY;

//     console.log(x + " " + y);
// }

function debugDump(inX,inY)
{
    console.log("")
    console.log("SandLevel base " + inX + ", " + inY)
    let tot = 0;
    let cnt = 0;
    for (let y = inY - 10; y < inY + 10; y++)
    {
        lineStr = "";
        for (let x = inX - 10; x < inX + 10; x++)
        {
            if (x < 0 || y < 0 || x >= sandTableSim.state.sandTableSideLen || y >= sandTableSim.state.sandTableSideLen)
                continue;
            let lev = sandTableSim.sandLevel[x][y];
            let sandLightness = sandTableSim.calcSandLightness(x, y, false, true);
            lineStr += (Math.round(lev*100)/100).toFixed(2) + " (" + (Math.round(sandLightness*100)/100).toFixed(2) + ") ";
            tot += sandTableSim.sandLevel[x][y];
            cnt++;
        }
        console.log(lineStr)
    }
    console.log("Tot " + tot + " cnt " + cnt + " avg " + tot/cnt);
}

function mouseclicktable(event)
{
    sandTableSim.tallySand();

    let img = document.querySelector('#table-canvas');
    let imgOff = img.getBoundingClientRect();

    let imgX = Math.floor(event.clientX - imgOff.left);
    let imgY = Math.floor(event.clientY - imgOff.top);

    // console.log("ClickTable " + imgX + ", " + imgY);

    // Dump sand level around point
    debugDump(imgX, imgY)

    // // let onePixStr = toRGBStr(colrArry[0]);
    // // var fullSq = this.ctx.getImageData(0, 0,
    // //                 this.state.sandTableSideLen,
    // //                 this.state.sandTableSideLen);

    // if (window.pageState.firstImgClick)
    // {
    //     window.pageState.clickPos = [imgX, imgY];
    // }
    // else
    // {
    //     let sandColours = [];
    //     let pixDataStr = "";
    //     xInc = (imgX - window.pageState.clickPos[0]) / sandTableSim.state.maxSandLevel;
    //     yInc = (imgY - window.pageState.clickPos[1]) / sandTableSim.state.maxSandLevel;
    //     for (let qq = 0; qq < sandTableSim.state.maxSandLevel; qq++)
    //     {
    //         let xx = window.pageState.clickPos[0] + xInc*qq;
    //         let yy = window.pageState.clickPos[1] + yInc*qq;
            
    //         let pixData = this.getImagePixels([xx, yy], window.pageState.imgPixSqSize);
    //         let colrArry = [];
    //         for (var i = 0; i < Math.pow(window.pageState.imgPixSqSize,2) * 4; i+=4)
    //             colrArry.push([pixData[i], pixData[i+1], pixData[i+2], pixData[i+3]]);
    //         pixDataStr += toRGBArrayStr(colrArry) + (qq != 9 ? "," : "") + "\n";
    //         sandColours.push(colrArry);
    //     }
    //     console.log(pixDataStr);
    //     sandTableSim.sandColours = sandColours;
    //     sandTableSim.initSand();
    //     sandTableSim.simStart({x:0, y:0, sizeX:sandTablePix,sizeY:sandTablePix, originX:sandTablePix/2, originY:sandTablePix/2});
    //     drawLine();
    // }
    // window.pageState.firstImgClick = !window.pageState.firstImgClick;
}


function mouseclickimg(event)
{
    let img = document.querySelector('#sand');
    let imgOff = img.getBoundingClientRect();

    let imgX = Math.floor(event.clientX - imgOff.left);
    let imgY = Math.floor(event.clientY - imgOff.top);

    console.log("ClickSand " + imgX + ", " + imgY);


    // let onePixStr = toRGBStr(colrArry[0]);
    // var fullSq = this.ctx.getImageData(0, 0,
    //                 this.state.sandTableSideLen,
    //                 this.state.sandTableSideLen);

    if (window.pageState.firstImgClick)
    {
        window.pageState.clickPos = [imgX, imgY];
    }
    else
    {
        let sandColours = [];
        let pixDataStr = "";
        xInc = (imgX - window.pageState.clickPos[0]) / sandTableSim.state.maxSandLevel;
        yInc = (imgY - window.pageState.clickPos[1]) / sandTableSim.state.maxSandLevel;
        for (let qq = 0; qq < sandTableSim.state.maxSandLevel; qq++)
        {
            let xx = window.pageState.clickPos[0] + xInc*qq;
            let yy = window.pageState.clickPos[1] + yInc*qq;
            
            let pixData = this.getImagePixels([xx, yy], window.pageState.imgPixSqSize);
            let colrArry = [];
            for (var i = 0; i < Math.pow(window.pageState.imgPixSqSize,2) * 4; i+=4)
                colrArry.push([pixData[i], pixData[i+1], pixData[i+2], pixData[i+3]]);
            pixDataStr += toRGBArrayStr(colrArry) + (qq != 9 ? "," : "") + "\n";
            sandColours.push(colrArry);
        }
        console.log(pixDataStr);
        sandTableSim.sandColours = sandColours;
        sandTableSim.initSand();
        sandTableSim.simStart({x:0, y:0, sizeX:sandTablePix,sizeY:sandTablePix, originX:sandTablePix/2, originY:sandTablePix/2});
        // drawLine();
    }
    window.pageState.firstImgClick = !window.pageState.firstImgClick;
}


function drawLine(x1,y1,x2,y2)
{
    let pts = Math.ceil(Math.max(Math.abs(x2-x1),Math.abs(y2-y1)));
    let xd = (x2-x1)/pts;
    let yd = (y2-y1)/pts;
    for (let i = 0; i < pts; i++)
    {
        sandTableSim.simNexPoint({x:x1+xd*i, y:y1+yd*i, sizeX:sandTablePix,sizeY:sandTablePix, originX:sandTablePix/2, originY:sandTablePix/2})
        // debugDump(sandTablePix/2,sandTablePix/2+i);
    }
}

function animate() {
    // return;
    for (let i = 0; i < 10; i++)
        moveStep();
    //this.showSand();
    requestAnimationFrame(animate);
}

function showLine(x1, y1, x2, y2) 
{
    let diffX = x2 - x1;
    let diffY = y2 - y1;
    let pts = 100;
    let lineData = [];
    for (let i = 0; i < pts; i++)
    {
        let ptX = x1 + diffX * i / pts;
        let ptY = y1 + diffY * i / pts;
        let val = sandTableSim.sandLevel[Math.floor(ptX)][Math.floor(ptY)];
        lineData.push({x: i, y: val})
    }

    var ctx = document.getElementById("chart-canvas").getContext('2d');
    var scatterChart = new Chart(ctx, {
        type: 'scatter',
        data: {
            datasets: [{
                label: 'Scatter Dataset',
                data: lineData
            }]
        },
        options: {
            scales: {
                xAxes: [{
                    type: 'linear',
                    position: 'bottom'
                }]
            }
        }
    });
}

function moveStep() {



    // let canvasOff = canvas.getBoundingClientRect();

    // let ballX = this.state.sandTableSideLen/2 + (this.state.sandTableSideLen / 2 - 20 - this.evalExpr.r) * Math.sin(this.evalExpr.t);
    // let ballY = this.state.sandTableSideLen/2 + (this.state.sandTableSideLen / 2 - 20 - this.evalExpr.r) * Math.cos(this.evalExpr.t);
    // this.evalExpr.t += 0.01;
    // this.evalExpr.r += 0.01;
    // if (this.evalExpr.t > 600)
    //     this.evalExpr.t = 0;

    // let t = window.pageState.evalExpr.t;
    // let ballX = Math.sin(t/20) * (270 - t/10) * (1 + Math.sin(t*1.03)*0.05);
    // let ballY = Math.cos(t/20) * (270 - t/10) * (1 + Math.sin(t*1.03)*0.05);
    // window.pageState.evalExpr.t += 0.2;
    // if (window.pageState.evalExpr.t > 3000)
    //     window.pageState.evalExpr.t = 0;
    // ballX = ballX;
    // ballY = ballY;

    let t = window.pageState.evalExpr.t;
    let ballX = 0;
    let ballY = 0;
    if (t < 2 * Math.PI * 410)
    {
        ballX = Math.sin(t/20) * (230 - t/5);
        ballY = Math.cos(t/20) * (230 - t/5);
    }
    else
    {
        ballX = Math.sin((t-15)/20) * 250;
        ballY = Math.cos((t-15)/20) * 250;
    }
    window.pageState.evalExpr.t += 0.2;
    // if (window.pageState.evalExpr.t > 3000)
    //     window.pageState.evalExpr.t = 0;
    ballX = ballX;
    ballY = ballY;

    sandTableSim.simNexPoint({x:ballX, y:ballY, sizeX:sandTablePix,sizeY:sandTablePix, originX:sandTablePix/2, originY:sandTablePix/2})

    // let ballAngle = Math.atan2(this.state.ballPos[1] - ballY, ballX - this.state.ballPos[0]);
    // this.state.ballPos[0] = ballX;
    // this.state.ballPos[1] = ballY;
    // this.moveSand(ballAngle);
}

let sandTablePix = 600;
let canvas = document.getElementById("table-canvas");
let ctx = canvas.getContext('2d');
canvas.height = sandTablePix;
canvas.width = sandTablePix;
window.pageState = { evalExpr: {t:0}, firstImgClick: true, imgPixSqSize: 5 }
let sandTableSim = new SandTableSim(20, sandTablePix, 10);

sandTableSim.simStart({x:0, y:0, sizeX:sandTablePix,sizeY:sandTablePix, originX:sandTablePix/2, originY:sandTablePix/2});
// drawLine(0,0,-200,190);
// drawLine(100,0,100,10);
// drawLine(100,10,0,10);
// animate();
// drawLine();

showLine(300, 280, 300, 320);


</script>
</body>
</html>
